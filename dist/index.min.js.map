{"version":3,"file":"index.min.js","sources":["../src/helpers/constants.ts","../src/helpers/calculation.helper.ts","../src/helpers/dom.helper.ts","../src/helpers/callbacks.ts","../src/helpers/category.helper.ts","../src/helpers/places-api.helper.ts","../src/helpers/places-list.helper.ts","../src/autocomplete.ts"],"sourcesContent":["export const BY_COUNTRYCODE = 'countrycode';\nexport const BY_RECT = 'rect';\nexport const BY_CIRCLE = 'circle';\nexport const BY_PROXIMITY = 'proximity';\nexport const BY_PLACE = 'place';\nexport const BY_GEOMETRY = 'geometry';\n","import {\n    ByCircleOptions,\n    ByCountryCodeOptions,\n    ByProximityOptions,\n    ByRectOptions,\n    GeocoderAutocompleteOptions\n} from \"../autocomplete\";\nimport { BY_CIRCLE, BY_COUNTRYCODE, BY_PLACE, BY_PROXIMITY, BY_RECT } from \"./constants\";\n\nexport class CalculationHelper {\n    public static isLatitude(num: any) {\n        return num !== '' && num !== null && isFinite(num) && Math.abs(num) <= 90;\n    }\n\n    public static isLongitude(num: any) {\n        return num !== '' && num !== null && isFinite(num) && Math.abs(num) <= 180;\n    }\n\n    public static isNotOpenStreetMapData(feature: any) {\n        return feature.properties.datasource?.sourcename !== 'openstreetmap' || !feature.properties.place_id;\n    }\n\n    public static extendByNonVerifiedValues(options: GeocoderAutocompleteOptions, features: any, parsedAddress: any) {\n        features.forEach((feature: any) => {\n            if (parsedAddress.housenumber &&\n                options.allowNonVerifiedHouseNumber && feature.properties.rank.match_type === \"match_by_street\") {\n                // add housenumber\n                this.addHouseNumberToFormatted(feature.properties, null, parsedAddress.housenumber)\n                feature.properties.nonVerifiedParts = [\"housenumber\"];\n            } else if (parsedAddress.street && parsedAddress.housenumber &&\n                options.allowNonVerifiedStreet &&\n                (feature.properties.rank.match_type === \"match_by_city_or_disrict\" || feature.properties.rank.match_type === \"match_by_postcode\")) {\n                // add housenumber and street\n                this.addHouseNumberToFormatted(feature.properties, parsedAddress.street, parsedAddress.housenumber)\n                feature.properties.nonVerifiedParts = [\"housenumber\", \"street\"];\n            } else if (parsedAddress.street &&\n                options.allowNonVerifiedStreet &&\n                (feature.properties.rank.match_type === \"match_by_city_or_disrict\" || feature.properties.rank.match_type === \"match_by_postcode\")) {\n                // add street\n                feature.properties.street = parsedAddress.street.replace(/(^\\w|\\s\\w|[-]\\w)/g, (m: string) => m.toUpperCase());\n\n                feature.properties.address_line1 = feature.properties.street;\n                feature.properties.address_line2 = feature.properties.formatted;\n\n                feature.properties.formatted = feature.properties.street + \", \" + feature.properties.formatted;\n                feature.properties.nonVerifiedParts = [\"street\"];\n            }\n        });\n    }\n\n    private static addHouseNumberToFormatted(featureProperties: any, street: string, housenumber: string) {\n        const houseNumberAndStreetFormatsPerCountry: { [key: string]: string[] } = {\n            \"{{{road}}} {{{house_number}}}\": [\"af\", \"ai\", \"al\", \"ao\", \"ar\", \"at\", \"aw\", \"ax\", \"ba\", \"be\", \"bg\", \"bi\", \"bo\", \"bq\", \"br\", \"bs\", \"bt\", \"bv\", \"bw\", \"cf\", \"ch\", \"cl\", \"cm\", \"co\", \"cr\", \"cu\", \"cv\", \"cw\", \"cy\", \"cz\", \"de\", \"dk\", \"do\", \"ec\", \"ee\", \"eh\", \"er\", \"et\", \"fi\", \"fo\", \"gd\", \"ge\", \"gl\", \"gq\", \"gr\", \"gt\", \"gw\", \"hn\", \"hr\", \"ht\", \"hu\", \"id\", \"il\", \"ir\", \"is\", \"jo\", \"ki\", \"km\", \"kp\", \"kw\", \"lc\", \"li\", \"lr\", \"lt\", \"lv\", \"ly\", \"me\", \"mk\", \"ml\", \"mn\", \"mo\", \"mx\", \"ni\", \"nl\", \"no\", \"np\", \"pa\", \"pe\", \"pl\", \"ps\", \"pt\", \"pw\", \"py\", \"qa\", \"ro\", \"rs\", \"ru\", \"sb\", \"sd\", \"se\", \"si\", \"sj\", \"sk\", \"so\", \"sr\", \"ss\", \"st\", \"sv\", \"sx\", \"sz\", \"td\", \"tj\", \"tl\", \"tr\", \"um\", \"uz\", \"uy\", \"vc\", \"ve\", \"vu\", \"ws\"],\n            \"{{{house_number}}} {{{road}}}\": [\"ad\", \"ae\", \"ag\", \"am\", \"as\", \"au\", \"az\", \"bb\", \"bd\", \"bf\", \"bh\", \"bl\", \"bm\", \"bz\", \"ca\", \"cc\", \"ci\", \"ck\", \"cn\", \"cx\", \"dj\", \"dm\", \"dz\", \"eg\", \"fj\", \"fk\", \"fm\", \"fr\", \"ga\", \"gb\", \"gf\", \"gg\", \"gh\", \"gi\", \"gm\", \"gn\", \"gp\", \"gs\", \"gu\", \"gy\", \"hk\", \"hm\", \"ie\", \"im\", \"io\", \"iq\", \"je\", \"jm\", \"jp\", \"ke\", \"kh\", \"kn\", \"kr\", \"ky\", \"lb\", \"lk\", \"ls\", \"lu\", \"ma\", \"mc\", \"mf\", \"mh\", \"mg\", \"mm\", \"mp\", \"ms\", \"mt\", \"mq\", \"mv\", \"mw\", \"my\", \"na\", \"nc\", \"ne\", \"nf\", \"ng\", \"nr\", \"nu\", \"nz\", \"om\", \"pf\", \"pg\", \"ph\", \"pk\", \"pm\", \"pr\", \"re\", \"rw\", \"sa\", \"sc\", \"sg\", \"sh\", \"sl\", \"sn\", \"tc\", \"tf\", \"th\", \"tk\", \"tn\", \"to\", \"tt\", \"tv\", \"tw\", \"tz\", \"ug\", \"us\", \"vg\", \"vi\", \"wf\", \"yt\", \"za\", \"zm\", \"zw\"],\n            \"{{{road}}}, {{{house_number}}}\": [\"by\", \"es\", \"it\", \"kg\", \"kz\", \"md\", \"mz\", \"sm\", \"sy\", \"ua\", \"va\"],\n            \"{{{house_number}}}, {{{road}}}\": [\"bj\", \"bn\", \"cd\", \"cg\", \"in\", \"la\", \"mr\", \"mu\", \"tg\", \"tm\", \"vn\", \"ye\"]\n        }\n\n        const format = Object.keys(houseNumberAndStreetFormatsPerCountry).find(key => houseNumberAndStreetFormatsPerCountry[key].indexOf(featureProperties.country_code) >= 0) || \"{{{road}}} {{{house_number}}}\";\n\n        if (street) {\n            // add street and housenumber\n            featureProperties.street = street.replace(/(^\\w|\\s\\w|[-]\\w)/g, m => m.toUpperCase());\n\n            featureProperties.housenumber = housenumber;\n            const addressPart = format.replace(\"{{{road}}}\", featureProperties.street).replace(\"{{{house_number}}}\", housenumber);\n            featureProperties.address_line1 = addressPart;\n            featureProperties.address_line2 = featureProperties.formatted;\n\n            featureProperties.formatted = addressPart + \", \" + featureProperties.formatted;\n        } else {\n            // add house number only\n            featureProperties.housenumber = housenumber;\n            const addressPart = format.replace(\"{{{road}}}\", featureProperties.street).replace(\"{{{house_number}}}\", housenumber);\n\n            featureProperties.address_line1 = featureProperties.address_line1.replace(featureProperties.street, addressPart);;\n            featureProperties.formatted = featureProperties.formatted.replace(featureProperties.street, addressPart);\n        }\n    }\n\n    public static generatePlacesUrl(placeDetailsUrl: string,\n                                    placeId: string,\n                                    apiKey: string,\n                                    options: GeocoderAutocompleteOptions): string {\n        let url = `${placeDetailsUrl}?id=${placeId}&apiKey=${apiKey}`;\n        if (options.lang) {\n            url += `&lang=${options.lang}`;\n        }\n        return url;\n    }\n\n    public static needToFilterDataBySuggestionsFilter(currentItems: any, suggestionsFilter?: (suggetions: any[]) => any[]) {\n        return currentItems && currentItems.length && suggestionsFilter && typeof suggestionsFilter === 'function';\n    }\n\n    public static needToCalculateExtendByNonVerifiedValues(data: any,\n                                                           options: GeocoderAutocompleteOptions) {\n        return data.features && data.features.length &&\n            data?.query?.parsed &&\n            (options.allowNonVerifiedHouseNumber || options.allowNonVerifiedStreet);\n    }\n\n    public static generateUrl(value: string,\n                              geocoderUrl: string,\n                              apiKey: string,\n                              options: GeocoderAutocompleteOptions): string {\n        let url = `${geocoderUrl}?text=${encodeURIComponent(value)}&apiKey=${apiKey}`;\n        // Add type of the location if set. Learn more about possible parameters on https://apidocs.geoapify.com/docs/geocoding/api/api\n        if (options.type) {\n            url += `&type=${options.type}`;\n        }\n\n        if (options.limit) {\n            url += `&limit=${options.limit}`;\n        }\n\n        if (options.lang) {\n            url += `&lang=${options.lang}`;\n        }\n\n        const filters = [];\n        const filterByCountryCodes: ByCountryCodeOptions = options.filter[BY_COUNTRYCODE] as ByCountryCodeOptions;\n        const filterByCircle: ByCircleOptions = options.filter[BY_CIRCLE] as ByCircleOptions;\n        const filterByRect: ByRectOptions = options.filter[BY_RECT] as ByRectOptions;\n        const filterByPlace: string = options.filter[BY_PLACE] as string;\n\n        if (filterByCountryCodes && filterByCountryCodes.length) {\n            filters.push(`countrycode:${filterByCountryCodes.join(',').toLowerCase()}`);\n        }\n\n        if (filterByCircle && CalculationHelper.isLatitude(filterByCircle.lat) && CalculationHelper.isLongitude(filterByCircle.lon) && filterByCircle.radiusMeters > 0) {\n            filters.push(`circle:${filterByCircle.lon},${filterByCircle.lat},${filterByCircle.radiusMeters}`);\n        }\n\n        if (filterByRect && CalculationHelper.isLatitude(filterByRect.lat1) && CalculationHelper.isLongitude(filterByRect.lon1) && CalculationHelper.isLatitude(filterByRect.lat2) && CalculationHelper.isLongitude(filterByRect.lon2)) {\n            filters.push(`rect:${filterByRect.lon1},${filterByRect.lat1},${filterByRect.lon2},${filterByRect.lat2}`);\n        }\n\n        if (filterByPlace) {\n            filters.push(`place:${filterByPlace}`);\n        }\n\n\n        url += filters.length ? `&filter=${filters.join('|')}` : '';\n\n        const bias = [];\n        const biasByCountryCodes: ByCountryCodeOptions = options.bias[BY_COUNTRYCODE] as ByCountryCodeOptions;\n        const biasByCircle: ByCircleOptions = options.bias[BY_CIRCLE] as ByCircleOptions;\n        const biasByRect: ByRectOptions = options.bias[BY_RECT] as ByRectOptions;\n        const biasByProximity: ByProximityOptions = options.bias[BY_PROXIMITY] as ByProximityOptions;\n\n        if (biasByCountryCodes && biasByCountryCodes.length) {\n            bias.push(`countrycode:${biasByCountryCodes.join(',').toLowerCase()}`);\n        }\n\n        if (biasByCircle && CalculationHelper.isLatitude(biasByCircle.lat) && CalculationHelper.isLongitude(biasByCircle.lon) && biasByCircle.radiusMeters > 0) {\n            bias.push(`circle:${biasByCircle.lon},${biasByCircle.lat},${biasByCircle.radiusMeters}`);\n        }\n\n        if (biasByRect && CalculationHelper.isLatitude(biasByRect.lat1) && CalculationHelper.isLongitude(biasByRect.lon1) && CalculationHelper.isLatitude(biasByRect.lat2) && CalculationHelper.isLongitude(biasByRect.lon2)) {\n            bias.push(`rect:${biasByRect.lon1},${biasByRect.lat1},${biasByRect.lon2},${biasByRect.lat2}`);\n        }\n\n        if (biasByProximity && CalculationHelper.isLatitude(biasByProximity.lat) && CalculationHelper.isLongitude(biasByProximity.lon)) {\n            bias.push(`proximity:${biasByProximity.lon},${biasByProximity.lat}`);\n        }\n\n        url += bias.length ? `&bias=${bias.join('|')}` : '';\n\n        return url;\n    }\n\n    public static returnIfFunction(func: any) {\n        if(func && typeof func === 'function') {\n            return func;\n        } else {\n            return null;\n        }\n    }\n}","import { GeocoderAutocompleteOptions } from \"../autocomplete\";\nimport countiesData from \"../countries.json\";\n\nexport class DomHelper {\n    public static createInputElement(inputElement: HTMLInputElement,\n                                      options: GeocoderAutocompleteOptions,\n                                      container: HTMLElement): HTMLElement {\n        inputElement.classList.add(\"geoapify-autocomplete-input\");\n        inputElement.setAttribute(\"type\", \"text\");\n        inputElement.setAttribute(\"placeholder\", options.placeholder || \"Enter an address here\");\n        \n        // Create wrapper for input and close button\n        const inputWrapper = document.createElement(\"div\");\n        inputWrapper.classList.add(\"geoapify-input-wrapper\");\n        inputWrapper.appendChild(inputElement);\n        container.appendChild(inputWrapper);\n        \n        return inputWrapper;\n    }\n\n    public static addFeatureIcon(element: HTMLElement, type: string, countryCode: string) {\n        const iconMap: any = {\n            'unknown': 'map-marker',\n            'amenity': 'map-marker',\n            'building': 'map-marker',\n            'street': 'road',\n            'suburb': 'city',\n            'district': 'city',\n            'postcode': 'city',\n            'city': 'city',\n            'county': 'city',\n            'state': 'city'\n        };\n\n        const countryData = countiesData.find(county => countryCode && county.code.toLowerCase() === countryCode.toLowerCase());\n\n        if ((type === 'country') && countryData) {\n            element.classList.add(\"emoji\");\n            const emojiElement = document.createElement('span');\n            emojiElement.innerText = countryData.emoji;\n            element.appendChild(emojiElement);\n        } else if (iconMap[type]) {\n            this.addIcon(element, iconMap[type])\n        } else {\n            this.addIcon(element, 'map-marker');\n        }\n    }\n\n\n    public static addIcon(element: HTMLElement, icon: string) {\n\n        //FortAwesome icons 5. Licence - https://fontawesome.com/license/free\n\n        const icons: { [key: string]: any } = {\n            \"close\": {\n                path: \"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\",\n                viewbox: \"0 0 24 24\"\n            },\n            \"map-marker\": {\n                path: \"M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z\",\n                viewbox: \"0 0 384 512\"\n            },\n            \"road\": {\n                path: \"M573.19 402.67l-139.79-320C428.43 71.29 417.6 64 405.68 64h-97.59l2.45 23.16c.5 4.72-3.21 8.84-7.96 8.84h-29.16c-4.75 0-8.46-4.12-7.96-8.84L267.91 64h-97.59c-11.93 0-22.76 7.29-27.73 18.67L2.8 402.67C-6.45 423.86 8.31 448 30.54 448h196.84l10.31-97.68c.86-8.14 7.72-14.32 15.91-14.32h68.8c8.19 0 15.05 6.18 15.91 14.32L348.62 448h196.84c22.23 0 36.99-24.14 27.73-45.33zM260.4 135.16a8 8 0 0 1 7.96-7.16h39.29c4.09 0 7.53 3.09 7.96 7.16l4.6 43.58c.75 7.09-4.81 13.26-11.93 13.26h-40.54c-7.13 0-12.68-6.17-11.93-13.26l4.59-43.58zM315.64 304h-55.29c-9.5 0-16.91-8.23-15.91-17.68l5.07-48c.86-8.14 7.72-14.32 15.91-14.32h45.15c8.19 0 15.05 6.18 15.91 14.32l5.07 48c1 9.45-6.41 17.68-15.91 17.68z\",\n                viewbox: \"0 0 576 512\"\n            },\n            \"city\": {\n                path: \"M616 192H480V24c0-13.26-10.74-24-24-24H312c-13.26 0-24 10.74-24 24v72h-64V16c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v80h-64V16c0-8.84-7.16-16-16-16H80c-8.84 0-16 7.16-16 16v80H24c-13.26 0-24 10.74-24 24v360c0 17.67 14.33 32 32 32h576c17.67 0 32-14.33 32-32V216c0-13.26-10.75-24-24-24zM128 404c0 6.63-5.37 12-12 12H76c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12H76c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12H76c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm128 192c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm160 96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12V76c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm160 288c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40zm0-96c0 6.63-5.37 12-12 12h-40c-6.63 0-12-5.37-12-12v-40c0-6.63 5.37-12 12-12h40c6.63 0 12 5.37 12 12v40z\",\n                viewbox: \"0 0 640 512\"\n            },\n            \"chevron-down\": {\n                path: \"M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z\",\n                viewbox: \"0 0 512 512\"\n            },\n            \"spinner\": {\n                path: \"M304 48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zm0 416a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM48 304a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm464-48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM142.9 437A48 48 0 1 0 75 369.1 48 48 0 1 0 142.9 437zm0-294.2A48 48 0 1 0 75 75a48 48 0 1 0 67.9 67.9zM369.1 437A48 48 0 1 0 437 369.1 48 48 0 1 0 369.1 437z\",\n                viewbox: \"0 0 512 512\"\n            },\n            \"clock\": {\n                path: \"M256 0a256 256 0 1 1 0 512A256 256 0 1 1 256 0zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z\",\n                viewbox: \"0 0 512 512\"\n            },\n            \"search\": {\n                path: \"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z\",\n                viewbox: \"0 0 512 512\"\n            },\n            \"ban\": {\n                path: \"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z\",\n                viewbox: \"0 0 512 512\"\n            },\n            \"filter\": {\n                path: \"M0 73.7C0 50.7 18.7 32 41.7 32H470.3c23 0 41.7 18.7 41.7 41.7c0 9.6-3.3 18.9-9.4 26.3L336 304.5V447.7c0 17.8-14.5 32.3-32.3 32.3c-7.1 0-14-2.3-19.6-6.6L176.2 399.6c-10.1-7.7-16.2-19.8-16.2-32.7V304.5L-9.4 100C-3.3 92.6 0 83.3 0 73.7z\",\n                viewbox: \"0 0 512 512\"\n            }\n        }\n\n        var svgElement = document.createElementNS(\"http://www.w3.org/2000/svg\", 'svg');\n        svgElement.setAttribute('viewBox', icons[icon].viewbox);\n        svgElement.setAttribute('height', \"18\");\n\n        var iconElement = document.createElementNS(\"http://www.w3.org/2000/svg\", 'path');\n        iconElement.setAttribute(\"d\", icons[icon].path);\n        iconElement.setAttribute('fill', 'currentColor');\n        svgElement.appendChild(iconElement);\n        element.appendChild(svgElement);\n    }\n\n    public static addSpinnerIcon(element: HTMLElement) {\n        const svgElement = document.createElementNS(\"http://www.w3.org/2000/svg\", 'svg');\n        svgElement.setAttribute('viewBox', '0 0 512 512');\n        svgElement.setAttribute('class', 'geoapify-places-spinner-icon');\n\n        const iconElement = document.createElementNS(\"http://www.w3.org/2000/svg\", 'path');\n        iconElement.setAttribute(\"d\", \"M304 48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zm0 416a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM48 304a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm464-48a48 48 0 1 0 -96 0 48 48 0 1 0 96 0zM142.9 437A48 48 0 1 0 75 369.1 48 48 0 1 0 142.9 437zm0-294.2A48 48 0 1 0 75 75a48 48 0 1 0 67.9 67.9zM369.1 437A48 48 0 1 0 437 369.1 48 48 0 1 0 369.1 437z\");\n        iconElement.setAttribute('fill', 'currentColor');\n        svgElement.appendChild(iconElement);\n        element.appendChild(svgElement);\n    }\n\n    public static  getStyledAddressSingleValue(value: string, currentValue: string): string {\n        let displayValue = value;\n\n        const valueIndex = (displayValue || '').toLowerCase().indexOf(currentValue.toLowerCase());\n        if (valueIndex >= 0) {\n            displayValue = displayValue.substring(0, valueIndex) +\n                `<strong>${displayValue.substring(valueIndex, valueIndex + currentValue.length)}</strong>` +\n                displayValue.substring(valueIndex + currentValue.length);\n        }\n\n        return `<span class=\"main-part\">${displayValue}</span>`\n    }\n\n    public static getStyledAddress(featureProperties: any, currentValue: string): string {\n        let mainPart: string;\n        let secondaryPart: string;\n        const parts = featureProperties.formatted.split(',').map((part: string) => part.trim());\n\n        if (featureProperties.name) {\n            mainPart = parts[0];\n            secondaryPart = parts.slice(1).join(', ');\n        } else {\n            const mainElements = Math.min(2, Math.max(parts.length - 2, 1));\n            mainPart = parts.slice(0, mainElements).join(', ');\n            secondaryPart = parts.slice(mainElements).join(', ');\n        }\n\n        if (featureProperties.nonVerifiedParts && featureProperties.nonVerifiedParts.length) {\n            featureProperties.nonVerifiedParts.forEach((part: string) => {\n                mainPart = mainPart.replace(featureProperties[part], `<span class=\"non-verified\">${featureProperties[part]}</span>`);\n            });\n        } else {\n            const valueIndex = mainPart.toLowerCase().indexOf(currentValue.toLowerCase());\n            if (valueIndex >= 0) {\n                mainPart = mainPart.substring(0, valueIndex) +\n                    `<strong>${mainPart.substring(valueIndex, valueIndex + currentValue.length)}</strong>` +\n                    mainPart.substring(valueIndex + currentValue.length);\n\n            }\n        }\n\n        return `<span class=\"main-part\">${mainPart}</span><span class=\"secondary-part\">${secondaryPart}</span>`\n    }\n\n    public static addDropdownIcon(feature: any, itemElement: HTMLDivElement) {\n        const iconElement = document.createElement(\"span\");\n        iconElement.classList.add('icon');\n\n        DomHelper.addFeatureIcon(iconElement, feature.properties.result_type, feature.properties.country_code);\n\n        itemElement.appendChild(iconElement);\n    }\n\n    public static addActiveClassToDropdownItem(items: HTMLCollectionOf<HTMLDivElement>, index: number) {\n        for (var i = 0; i < items.length; i++) {\n            items[i].classList.remove(\"active\");\n        }\n\n        /* Add class \"autocomplete-active\" to the active element*/\n        items[index].classList.add(\"active\");\n    }\n\n    public static createDropdownItemText() {\n        const textElement = document.createElement(\"span\");\n        textElement.classList.add('address');\n        return textElement;\n    }\n\n    public static createDropdownItem() {\n        const itemElement = document.createElement(\"div\");\n        itemElement.classList.add('geoapify-autocomplete-item');\n        return itemElement;\n    }\n}","import { GeocoderEventType, ItemType, Category } from \"../types/external\";\n\nexport class Callbacks {\n    public changeCallbacks: ((selectedOption: any) => void)[] = [];\n    public suggestionsChangeCallbacks: ((options: any[]) => void)[] = [];\n    public inputCallbacks: ((input: string) => void)[] = [];\n    public openCallbacks: ((opened: boolean) => void)[] = [];\n    public closeCallbacks: ((opened: boolean) => void)[] = [];\n    public requestStartCallbacks: ((query: string) => void)[] = [];\n    public requestEndCallbacks: ((success: boolean, data?: any, error?: any) => void)[] = [];\n    \n    public placesCallbacks: ((places: GeoJSON.Feature[]) => void)[] = [];\n    public placesRequestStartCallbacks: ((category: Category) => void)[] = [];\n    public placesRequestEndCallbacks: ((success: boolean, data?: any, error?: any) => void)[] = [];\n    public placeDetailsRequestStartCallbacks: ((place: GeoJSON.Feature) => void)[] = [];\n    public placeDetailsRequestEndCallbacks: ((success: boolean, data?: any, error?: any) => void)[] = [];\n    public placeSelectCallbacks: ((place: GeoJSON.Feature, index: number) => void)[] = [];\n\n    public clearCallbacks: ((itemType: ItemType) => void)[] = [];\n\n    addCallback(operation: GeocoderEventType, callback: (param: any) => void) {\n        let currentCallbacks = this.getCallbacksByOperation(operation);\n        if(currentCallbacks) {\n            if (currentCallbacks.indexOf(callback) < 0) {\n                currentCallbacks.push(callback);\n            }\n        }\n    }\n\n    removeCallback(operation: GeocoderEventType, callback?: (param: any) => any) {\n        let currentCallbacks = this.getCallbacksByOperation(operation);\n        if(currentCallbacks) {\n            if (currentCallbacks.indexOf(callback) >= 0) {\n                currentCallbacks.splice(currentCallbacks.indexOf(callback), 1);\n                this.setCallbacksByOperation(operation, currentCallbacks);\n            } else if (!callback) {\n                this.setCallbacksByOperation(operation, []);\n            }\n        }\n    }\n\n    notifyInputChange(currentValue: string) {\n        this.inputCallbacks.forEach(callback => callback(currentValue));\n    }\n\n    notifyChange(feature: any){\n        this.changeCallbacks.forEach(callback => callback(feature));\n    }\n\n    notifySuggestions(features: any) {\n        this.suggestionsChangeCallbacks.forEach(callback => callback(features));\n    }\n\n    notifyOpened() {\n        this.openCallbacks.forEach(callback => callback(true));\n    }\n\n    notifyClosed() {\n        this.closeCallbacks.forEach(callback => callback(false));\n    }\n\n    notifyRequestStart(query: string) {\n        this.requestStartCallbacks.forEach(callback => callback(query));\n    }\n\n    notifyRequestEnd(success: boolean, data?: any, error?: any) {\n        this.requestEndCallbacks.forEach(callback => callback(success, data, error));\n    }\n\n    notifyPlaces(places: GeoJSON.Feature[]) {\n        this.placesCallbacks.forEach(callback => callback(places));\n    }\n\n    notifyPlacesRequestStart(category: Category) {\n        this.placesRequestStartCallbacks.forEach(callback => callback(category));\n    }\n\n    notifyPlacesRequestEnd(success: boolean, data?: any, error?: any) {\n        this.placesRequestEndCallbacks.forEach(callback => callback(success, data, error));\n    }\n\n    notifyPlaceDetailsRequestStart(place: GeoJSON.Feature) {\n        this.placeDetailsRequestStartCallbacks.forEach(callback => callback(place));\n    }\n\n    notifyPlaceDetailsRequestEnd(success: boolean, data?: any, error?: any) {\n        this.placeDetailsRequestEndCallbacks.forEach(callback => callback(success, data, error));\n    }\n\n    notifyPlaceSelect(place: GeoJSON.Feature, index: number) {\n        this.placeSelectCallbacks.forEach(callback => callback(place, index));\n    }\n\n    notifyClear(itemType: ItemType) {\n        this.clearCallbacks.forEach(callback => callback(itemType));\n    }\n\n    private getCallbacksByOperation(operation: GeocoderEventType) {\n        let currentCallbacks = null;\n        switch (operation) {\n            case 'select': {\n                currentCallbacks = this.changeCallbacks;\n                break;\n            }\n            case 'suggestions': {\n                currentCallbacks = this.suggestionsChangeCallbacks;\n                break;\n            }\n            case 'input': {\n                currentCallbacks = this.inputCallbacks;\n                break;\n            }\n            case 'close': {\n                currentCallbacks = this.closeCallbacks;\n                break;\n            }\n            case 'open': {\n                currentCallbacks = this.openCallbacks;\n                break;\n            }\n            case 'request_start': {\n                currentCallbacks = this.requestStartCallbacks;\n                break;\n            }\n            case 'request_end': {\n                currentCallbacks = this.requestEndCallbacks;\n                break;\n            }\n            case 'places': {\n                currentCallbacks = this.placesCallbacks;\n                break;\n            }\n            case 'places_request_start': {\n                currentCallbacks = this.placesRequestStartCallbacks;\n                break;\n            }\n            case 'places_request_end': {\n                currentCallbacks = this.placesRequestEndCallbacks;\n                break;\n            }\n            case 'place_details_request_start': {\n                currentCallbacks = this.placeDetailsRequestStartCallbacks;\n                break;\n            }\n            case 'place_details_request_end': {\n                currentCallbacks = this.placeDetailsRequestEndCallbacks;\n                break;\n            }\n            case 'place_select': {\n                currentCallbacks = this.placeSelectCallbacks as any;\n                break;\n            }\n            case 'clear': {\n                currentCallbacks = this.clearCallbacks;\n                break;\n            }\n        }\n        return currentCallbacks;\n    }\n\n    private setCallbacksByOperation(operation: GeocoderEventType, callbacks: ((data: any) => void)[]) {\n        switch (operation) {\n            case 'select': {\n                this.changeCallbacks = callbacks;\n                break;\n            }\n            case 'suggestions': {\n                this.suggestionsChangeCallbacks = callbacks;\n                break;\n            }\n            case 'input': {\n                this.inputCallbacks = callbacks;\n                break;\n            }\n            case 'close': {\n                this.closeCallbacks = callbacks;\n                break;\n            }\n            case 'open': {\n                this.openCallbacks = callbacks;\n                break;\n            }\n            case 'request_start': {\n                this.requestStartCallbacks = callbacks;\n                break;\n            }\n            case 'request_end': {\n                this.requestEndCallbacks = callbacks;\n                break;\n            }\n            case 'places': {\n                this.placesCallbacks = callbacks;\n                break;\n            }\n            case 'places_request_start': {\n                this.placesRequestStartCallbacks = callbacks;\n                break;\n            }\n            case 'places_request_end': {\n                this.placesRequestEndCallbacks = callbacks;\n                break;\n            }\n            case 'place_details_request_start': {\n                this.placeDetailsRequestStartCallbacks = callbacks;\n                break;\n            }\n            case 'place_details_request_end': {\n                this.placeDetailsRequestEndCallbacks = callbacks;\n                break;\n            }\n            case 'place_select': {\n                this.placeSelectCallbacks = callbacks as any;\n                break;\n            }\n            case 'clear': {\n                this.clearCallbacks = callbacks;\n                break;\n            }\n        }\n    }\n}","import { Category } from \"../types/external\";\n\nexport class CategoryManager {\n    private selectedCategory: Category | null = null;\n    private isCategoryMode: boolean = false;\n\n    public setCategory(category: Category | string | string[] | null): void {\n        if (category === null) {\n            this.clearCategory();\n            return;\n        }\n\n        if (typeof category === 'string') {\n            // Convert single string to array\n            this.selectedCategory = { keys: [category], label: category };\n        } else if (Array.isArray(category)) {\n            // Convert array of strings to Category with joined label\n            this.selectedCategory = { keys: category, label: category.join(', ') };\n        } else {\n            this.selectedCategory = category;\n            \n        }\n\n        this.isCategoryMode = true;\n    }\n\n    public getCategory(): Category | null {\n        return this.selectedCategory;\n    }\n\n    public isCategoryModeActive(): boolean {\n        return this.isCategoryMode && this.selectedCategory !== null;\n    }\n\n    public clearCategory(): void {\n        this.selectedCategory = null;\n        this.isCategoryMode = false;\n    }\n\n    public extractCategoriesFromResponse(data: any): Category[] {\n        if (!data?.query?.categories) {\n            return [];\n        }\n\n        return data.query.categories.map((cat: any) => ({\n            // Normalize category to always be an array\n            keys: cat.keys,\n            label: cat.label\n        }));\n    }\n\n}\n","import { GeocoderAutocompleteOptions, GeoPosition, ByProximityOptions, ByCircleOptions, ByRectOptions } from \"../autocomplete\";\nimport { IpGeolocationResponse } from \"../types/internal\";\nimport { CalculationHelper } from \"./calculation.helper\";\nimport { BY_CIRCLE, BY_PLACE, BY_PROXIMITY, BY_RECT } from \"./constants\";\n\nexport class PlacesApiHelper {\n\n    public static generatePlacesUrl(\n        category: string[],\n        apiKey: string,\n        options: GeocoderAutocompleteOptions,\n        placesApiUrl: string,\n        offset?: number,\n        limit?: number,\n        bias?: { [key: string]: ByProximityOptions | ByCircleOptions | ByRectOptions },\n        filter?: { [key: string]: ByCircleOptions | ByRectOptions | string }\n    ): string {\n        const categoriesParam = category.map(c => encodeURIComponent(c)).join(',');\n        let url = `${placesApiUrl}?categories=${categoriesParam}&apiKey=${apiKey}`;\n\n        if (options.lang) {\n            url += `&lang=${options.lang}`;\n        }\n\n        if (limit !== undefined && limit > 0) {\n            url += `&limit=${limit}`;\n        }\n\n        if (offset !== undefined && offset > 0) {\n            url += `&offset=${offset}`;\n        }\n\n        // Merge filter: passed parameter takes precedence over options\n        const effectiveFilter = filter || this.convertGeocoderFilterToPlacesApiFilter(options.filter);\n        const filters = this.generatePlacesApiFilterString(effectiveFilter);\n        if (filters) {\n            url += `&filter=${filters}`;\n        }\n\n        // Merge bias: passed parameter takes precedence over options\n        const effectiveBias = bias || this.convertGeocoderBiasToPlacesApiBias(options.bias);\n        const biasString = this.generatePlacesApiBiasString(effectiveBias);\n        if (biasString) {\n            url += `&bias=${biasString}`;\n        }\n\n        return url;\n    }\n\n    public static sendPlacesRequest(url: string): Promise<any> {\n        return new Promise((resolve, reject) => {\n            fetch(url)\n                .then((response) => {\n                    if (response.ok) {\n                        response.json().then(data => resolve(data));\n                    } else {\n                        response.json().then(data => reject(data));\n                    }\n                })\n                .catch(error => reject(error));\n        });\n    }\n\n    public static async getLocationForBias(\n        apiKey: string,\n        options: GeocoderAutocompleteOptions,\n        ipGeolocationUrl: string\n    ): Promise<GeoPosition | null> {\n        const existingProximity = options.bias?.['proximity'] as any;\n        if (existingProximity && \n            CalculationHelper.isLatitude(existingProximity.lat) && \n            CalculationHelper.isLongitude(existingProximity.lon)) {\n            return {\n                lat: existingProximity.lat,\n                lon: existingProximity.lon\n            };\n        }\n\n        try {\n            const ipUrl = `${ipGeolocationUrl}?apiKey=${apiKey}`;\n            const response = await fetch(ipUrl);\n            \n            if (response.ok) {\n                const data: IpGeolocationResponse = await response.json();\n                return {\n                    lat: data.location.latitude,\n                    lon: data.location.longitude\n                };\n            }\n        } catch (error) {\n            console.warn('Failed to get location for Places API bias:', error);\n        }\n\n        return null;\n    }\n\n    public static convertGeocoderBiasToPlacesApiBias(bias?: { [key: string]: any }): { [key: string]: ByProximityOptions | ByCircleOptions | ByRectOptions } | undefined {\n        if (!bias) return undefined;\n\n        const placesApiBias: { [key: string]: ByProximityOptions } = {};\n\n        if (bias[BY_PROXIMITY]) {\n            placesApiBias[BY_PROXIMITY] = bias[BY_PROXIMITY];\n        }\n\n        if (bias[BY_CIRCLE]) {\n            placesApiBias[BY_CIRCLE] = bias[BY_CIRCLE]\n        }\n\n        if (bias[BY_RECT]) {\n            placesApiBias[BY_RECT] = bias[BY_RECT]\n        }\n\n        return Object.keys(placesApiBias).length > 0 ? placesApiBias : undefined;\n    }\n\n    public static convertGeocoderFilterToPlacesApiFilter(filter?: { [key: string]: any }): { [key: string]: ByCircleOptions | ByRectOptions | string } | undefined {\n        if (!filter) return undefined;\n\n        const placesApiFilter: { [key: string]: ByCircleOptions | ByRectOptions | string } = {};\n\n        if (filter[BY_CIRCLE]) {\n            placesApiFilter[BY_CIRCLE] = filter[BY_CIRCLE];\n        }\n\n        if (filter[BY_RECT]) {\n            placesApiFilter[BY_RECT] = filter[BY_RECT];\n        }\n\n        if (filter[BY_PLACE] && typeof filter[BY_PLACE] === 'string') {\n            placesApiFilter[BY_PLACE] = filter[BY_PLACE];\n        }\n\n        return Object.keys(placesApiFilter).length > 0 ? placesApiFilter : undefined;\n    }\n\n    private static generatePlacesApiFilterString(\n        filter?: { [key: string]: ByCircleOptions | ByRectOptions | string }\n    ): string {\n        if (!filter) return '';\n        \n        const filters: string[] = [];\n        \n        Object.keys(filter).forEach(key => {\n            const value = filter[key];\n            if (value) {\n                if (key === 'circle') {\n                    const circleValue = value as ByCircleOptions;\n                    if (circleValue.lat && circleValue.lon && circleValue.radiusMeters) {\n                        filters.push(`circle:${circleValue.lon},${circleValue.lat},${circleValue.radiusMeters}`);\n                    }\n                } else if (key === 'rect') {\n                    const rectValue = value as ByRectOptions;\n                    if (rectValue.lat1 && rectValue.lon1 && rectValue.lat2 && rectValue.lon2) {\n                        filters.push(`rect:${rectValue.lon1},${rectValue.lat1},${rectValue.lon2},${rectValue.lat2}`);\n                    }\n                } else if (key === 'place' || key === 'geometry') {\n                    const stringValue = value as string;\n                    if (stringValue) {\n                        filters.push(`${key}:${stringValue}`);\n                    }\n                }\n            }\n        });\n\n        return filters.join('|');\n    }\n\n    private static generatePlacesApiBiasString(\n        bias?: { [key: string]: ByProximityOptions | ByCircleOptions | ByRectOptions }\n    ): string {\n        const biases: string[] = [];\n        \n        if (bias) {\n            Object.keys(bias).forEach(key => {\n                const value = bias[key];\n                if (value && key === 'proximity') {\n                    const proximityBias = value as ByProximityOptions;\n                    if (proximityBias.lat && proximityBias.lon) {\n                        biases.push(`proximity:${proximityBias.lon},${proximityBias.lat}`);\n                    }\n                } else if (key === 'rect') {\n                    const rectValue = value as ByRectOptions;\n                    if (rectValue.lat1 && rectValue.lon1 && rectValue.lat2 && rectValue.lon2) {\n                        biases.push(`rect:${rectValue.lon1},${rectValue.lat1},${rectValue.lon2},${rectValue.lat2}`);\n                    }\n                } else if (key === 'circle') {\n                    const circleValue = value as ByCircleOptions;\n                    if (circleValue.lat && circleValue.lon && circleValue.radiusMeters) {\n                        biases.push(`circle:${circleValue.lon},${circleValue.lat},${circleValue.radiusMeters}`);\n                    }\n                }\n            });\n        }\n\n        return biases.join('|');\n    }\n}\n","import { DomHelper } from \"./dom.helper\";\nimport { GeocoderAutocompleteOptions } from \"../autocomplete\";\n\nexport interface PlacesListCallbacks {\n    onPlaceSelect: (place: GeoJSON.Feature, index: number) => void;\n    onLoadMore: (offset: number) => Promise<any>;\n    onPlacesUpdate: (allPlaces: GeoJSON.Feature[]) => void;\n}\n\ninterface PlaceData {\n    name: string;\n    address: string | null;\n    openingHours: string | null;\n}\n\nexport class PlacesListManager {\n    private container: HTMLElement;\n    private options: GeocoderAutocompleteOptions;\n    private callbacks: PlacesListCallbacks;\n\n    private placesListElement: HTMLElement = null;\n    private titleBar: HTMLElement = null;\n    private scrollContainer: HTMLElement = null;\n    private statusBar: HTMLElement = null;\n    private loadMoreElement: HTMLElement = null;\n\n    // Pagination state\n    private currentOffset: number = 0;\n    private currentCategory: string[] = null;\n    private currentCategoryLabel: string = null;\n    private isLoadingMorePlaces: boolean = false;\n    private hasMorePlaces: boolean = true;\n    private places: GeoJSON.Feature[] = [];\n\n    // Scroll detection\n    private scrollListener: ((event: Event) => void) | null = null;\n\n    private selectedPlaceIndex: number | null = null;\n\n    constructor(\n        container: HTMLElement,\n        options: GeocoderAutocompleteOptions,\n        callbacks: PlacesListCallbacks\n    ) {\n        this.container = container;\n        this.options = options;\n        this.callbacks = callbacks;\n    }\n\n    public setCurrentOffset(offset: number) {\n        this.currentOffset = offset;\n    }\n\n    public getCurrentOffset(): number {\n        return this.currentOffset;\n    }\n\n    public setCategory(category: string[], categoryLabel: string) {\n        this.currentCategory = category;\n        this.currentCategoryLabel = categoryLabel ?? category.join(', ');\n    }\n\n    public showPlacesList(placesToRender: GeoJSON.Feature[],  isLoadMore: boolean = false): void {\n        if (!this.options.showPlacesList) return;\n\n        // Create elements if they don't exist\n        if (!this.placesListElement) {\n            this.createPlacesElements();\n        }\n\n        if (!this.places || this.places.length === 0  /* places contain already pleaseToRender */) {\n            this.showEmptyState();\n            this.updateStatusBar();\n            this.showList(false);\n            return;\n        }\n\n        // Add new places\n        this.renderPlaces(placesToRender, isLoadMore);\n\n        this.updateStatusBar();\n\n        this.updateStatusBarState('empty');\n\n        // Setup scroll detection\n        if (this.hasMorePlaces) {\n            this.setupScrollDetection();\n        } else {\n            this.updateStatusBarState('end');\n        }\n\n        // Show list\n        this.showList(isLoadMore);\n    }\n\n    public filterDuplicatePlaces(newPlaces: GeoJSON.Feature[]): GeoJSON.Feature[] {\n        const existingPlaceIds = new Set(\n            this.places\n                .map(place => place.properties?.place_id)\n                .filter(id => id !== undefined)\n        );\n\n        return newPlaces.filter(place => {\n            const placeId = place.properties?.place_id;\n            return !placeId || !existingPlaceIds.has(placeId);\n        });\n    }\n\n    public setPlaces(places: GeoJSON.Feature[], append?: boolean) {\n        this.hasMorePlaces = places.length === this.options.placesLimit;\n\n        if (append) {\n            const newPlaces = this.filterDuplicatePlaces(places);\n            this.places.push(...newPlaces);\n            this.showPlacesList(newPlaces, true); \n        } else {\n            this.selectedPlaceIndex = null;\n            this.clearPlacesItems();\n            this.places = [];\n            this.places.push(...places);\n            this.showPlacesList(places); \n        }\n\n        this.updateTitleBar(this.currentCategoryLabel);\n\n        // Notify callback\n        this.callbacks.onPlacesUpdate?.(this.places);\n    }\n\n/*    public addPlaces(places: GeoJSON.Feature[], currentPlacesOffset: number) {\n            \n        this.hasMorePlaces = places.length === this.options.placesLimit;\n        this.currentPlacesOffset = currentPlacesOffset;\n\n        const newPlaces = this.filterDuplicatePlaces(places);\n        this.places.push(...newPlaces);\n        this.showPlacesList(newPlaces); \n\n        // Notify callback\n        this.callbacks.onPlacesUpdate?.(this.places);\n    }\n\n    public setPlaces(places: GeoJSON.Feature[], currentPlacesOffset: number) {\n        this.places = [];\n        this.selectedPlaceIndex = null;\n        this.clearPlacesItems();\n        this.updateTitleBar(this.currentCategoryLabel);\n        this.places.push(...places);\n        this.showPlacesList(places); \n\n        this.currentPlacesOffset = currentPlacesOffset;\n\n        // Notify callback\n        this.callbacks.onPlacesUpdate?.(this.places);\n    }\n\n*/\n\n    public getPlaces(): GeoJSON.Feature[] {\n        return this.places;\n    }\n\n    public clearPlacesList(): void {\n        if (!this.options.showPlacesList) return;\n\n        if (this.scrollContainer) {\n            this.scrollContainer.innerHTML = '';\n        }\n\n        if (this.placesListElement) {\n            this.placesListElement.classList.remove('active', 'standalone');\n        }\n\n        this.removeScrollListener();\n        this.resetPaginationState();\n    }\n\n    public isPlacesListVisible(): boolean {\n        if (!this.placesListElement) return false;\n        return this.placesListElement.classList.contains('active');\n    }\n\n    private clearPlacesItems(): void {\n        if (this.scrollContainer) {\n            this.scrollContainer.innerHTML = '';\n        }\n    }\n\n    public resetCategory(): void {\n        this.currentCategory = null;\n        this.clearPlacesList();\n    }\n\n    public selectPlace(index: number): void {\n        if (!this.scrollContainer) return;\n\n        this.selectedPlaceIndex = index;\n        this.updateStatusBar();\n\n        // Remove previous selection\n        const placeItems = this.scrollContainer.querySelectorAll('.geoapify-places-item');\n        placeItems.forEach(item => {\n            item.classList.remove('active');\n        });\n\n        // Add selection to the specified item\n        const targetItem = this.scrollContainer.querySelector(`[data-index=\"${index}\"]`);\n        if (targetItem) {\n            targetItem.classList.add('active');\n            // Scroll item into view if needed (if supported)\n            if (typeof targetItem.scrollIntoView === 'function') {\n                targetItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n            }\n        }\n    }\n\n    public clearSelection(): void {\n        if (!this.scrollContainer) return;\n\n        this.selectedPlaceIndex = null;\n        this.updateStatusBar();\n\n        // Remove selection from all items\n        const placeItems = this.scrollContainer.querySelectorAll('.geoapify-places-item');\n        placeItems.forEach(item => {\n            item.classList.remove('active');\n        });\n    }\n\n    private createPlacesElements(): void {\n        if (!this.options.showPlacesList) return;\n\n        // Main container\n        this.placesListElement = document.createElement('div');\n        this.placesListElement.className = 'geoapify-places-list';\n\n        // Title bar\n        /*this.titleBar = document.createElement('div');\n        this.titleBar.className = 'geoapify-places-title-bar';\n        this.placesListElement.appendChild(this.titleBar);*/\n\n        // Scroll container\n        this.scrollContainer = document.createElement('div');\n        this.scrollContainer.className = 'geoapify-places-scroll-container';\n        this.placesListElement.appendChild(this.scrollContainer);\n\n        // Status bar (at the bottom, outside scroll container - currently empty)\n        /*this.statusBar = document.createElement('div');\n        this.statusBar.className = 'geoapify-places-status-bar';\n        this.placesListElement.appendChild(this.statusBar);*/\n\n        // Load more element (will be inside scroll container at the end of the list)\n        this.loadMoreElement = document.createElement('div');\n        this.loadMoreElement.className = 'geoapify-places-load-more';\n\n        this.container.appendChild(this.placesListElement);\n    }\n\n    private renderPlaces(places: GeoJSON.Feature[], isLoadMore: boolean): void {\n        if (this.loadMoreElement.parentNode === this.scrollContainer) {\n            this.loadMoreElement.remove();\n        }\n\n        const startIndex = isLoadMore ? this.scrollContainer.children.length : 0;\n\n        places.forEach((place, index) => {\n            const placeElement = this.createPlaceItem(place, startIndex + index);\n            this.scrollContainer.appendChild(placeElement);\n        });\n\n        this.scrollContainer.appendChild(this.loadMoreElement);\n    }\n\n    private showList(isLoadMore: boolean): void {\n        this.placesListElement.classList.add('active', 'standalone');\n\n        if (!isLoadMore && this.scrollContainer) {\n            this.scrollContainer.scrollTop = 0;\n        }\n    }\n\n    private showEmptyState(): void {\n        if (!this.scrollContainer) return;\n\n        this.scrollContainer.innerHTML = '';\n\n        const emptyState = document.createElement('div');\n        emptyState.className = 'geoapify-places-empty-state';\n\n        const iconElement = document.createElement('div');\n        iconElement.className = 'geoapify-places-empty-icon';\n\n        DomHelper.addIcon(iconElement, 'ban');\n\n        emptyState.appendChild(iconElement);\n\n        this.scrollContainer.appendChild(emptyState);\n    }\n\n    private resetPaginationState(): void {\n        this.currentOffset = 0;\n        this.currentCategory = null;\n        this.currentCategoryLabel = null;\n        this.hasMorePlaces = true;\n        this.isLoadingMorePlaces = false;\n        this.places = [];\n        this.selectedPlaceIndex = null;\n    }\n\n    private updateTitleBar(categoryLabel: string): void {\n        if (!this.titleBar) return;\n\n        this.titleBar.innerHTML = '';\n\n        const filterIcon = document.createElement('span');\n        filterIcon.className = 'geoapify-places-title-icon';\n        //DomHelper.addIcon(filterIcon, 'filter');\n\n        const labelSpan = document.createElement('span');\n        labelSpan.className = 'geoapify-places-title-label';\n        labelSpan.textContent = categoryLabel;\n\n        this.titleBar.appendChild(filterIcon);\n        this.titleBar.appendChild(labelSpan);\n    }\n\n    private updateStatusBar(): void {\n        if (!this.statusBar) return;\n\n        this.statusBar.innerHTML = '';\n\n        // Create icon + count on the left\n        const countContainer = document.createElement('div');\n        countContainer.className = 'geoapify-places-status-count';\n\n        const iconElement = document.createElement('span');\n        DomHelper.addIcon(iconElement, 'map-marker');\n        countContainer.appendChild(iconElement);\n\n        const countText = document.createElement('span');\n        countText.textContent = this.places.length.toString();\n        countContainer.appendChild(countText);\n\n        this.statusBar.appendChild(countContainer);\n\n        // Show selected item index on the right if a place is selected\n        if (this.selectedPlaceIndex !== null) {\n            const selectedInfo = document.createElement('div');\n            selectedInfo.className = 'geoapify-places-status-selected';\n            selectedInfo.textContent = `${this.selectedPlaceIndex + 1} / ${this.places.length}`;\n            this.statusBar.appendChild(selectedInfo);\n        }\n    }\n\n    private updateStatusBarState(state: 'empty' | 'button' | 'loading' | 'end'): void {\n        if (!this.loadMoreElement) return;\n\n        this.loadMoreElement.innerHTML = '';\n\n        // Hide the element when there are no more results\n        if (state === 'end' || state === 'empty') {\n            this.loadMoreElement.style.display = 'none';\n            this.loadMoreElement.className = 'geoapify-places-load-more';\n            return;\n        }\n\n        // Show the element for button and loading states\n        this.loadMoreElement.style.display = '';\n        this.loadMoreElement.className = `geoapify-places-load-more ${state}`;\n\n        if (state === 'button') {\n            const button = document.createElement('button');\n            button.className = 'geoapify-places-load-more-button';\n            button.setAttribute('type', 'button');\n            button.setAttribute('aria-label', 'Load more places');\n            button.addEventListener('click', () => this.loadMorePlaces());\n\n            const iconElement = document.createElement('span');\n            DomHelper.addIcon(iconElement, 'chevron-down');\n            button.appendChild(iconElement);\n\n            this.loadMoreElement.appendChild(button);\n        } else if (state === 'loading') {\n            const dots = document.createElement('span');\n            dots.className = 'geoapify-places-load-more-loading';\n            dots.textContent = '';\n            this.loadMoreElement.appendChild(dots);\n        }\n    }\n\n    // ========================================================================\n    // PLACE ITEM CREATION\n    // ========================================================================\n\n    private createPlaceItem(place: GeoJSON.Feature, index: number): HTMLElement {\n        const placeElement = document.createElement('div');\n        placeElement.className = 'geoapify-places-item';\n        placeElement.dataset.index = index.toString();\n\n        const placeData = this.extractPlaceData(place);\n\n        // Container for name and address\n        const textContainer = document.createElement('div');\n        textContainer.className = 'geoapify-places-text-container';\n\n        // Place name\n        const nameElement = document.createElement('span');\n        nameElement.className = 'geoapify-places-main-part';\n        nameElement.textContent = placeData.name;\n        textContainer.appendChild(nameElement);\n\n        // Address - only if available\n        if (placeData.address) {\n            const addressElement = document.createElement('span');\n            addressElement.className = 'geoapify-places-secondary-part';\n            addressElement.textContent = placeData.address;\n            textContainer.appendChild(addressElement);\n        }\n\n        placeElement.appendChild(textContainer);\n\n        // Opening hours (text + icon) - only if available\n        if (placeData.openingHours) {\n            const hoursContainer = document.createElement('span');\n            hoursContainer.className = 'geoapify-places-hours-info';\n\n            const clockIcon = document.createElement('span');\n            clockIcon.className = 'geoapify-places-clock-icon';\n            DomHelper.addIcon(clockIcon, 'clock');\n\n            const hoursText = document.createElement('span');\n            hoursText.className = 'geoapify-places-hours-text';\n            hoursText.textContent = placeData.openingHours;\n            hoursText.title = placeData.openingHours;\n\n            hoursContainer.appendChild(clockIcon);\n            hoursContainer.appendChild(hoursText);\n            placeElement.appendChild(hoursContainer);\n        }\n\n        placeElement.addEventListener('click', () => {\n            this.selectedPlaceIndex = index;\n            this.updateStatusBar();\n            this.selectPlaceFromList(place, index);\n        });\n\n        return placeElement;\n    }\n\n    private extractPlaceData(place: GeoJSON.Feature): PlaceData {\n        const props = place.properties;\n        return {\n            name: props.name || '---',\n            address: props.address_line2 || props.formatted || null,\n            openingHours: props.opening_hours || null\n        };\n    }\n\n    // ========================================================================\n    // LOAD MORE FUNCTIONALITY & SCROLL DETECTION\n    // ========================================================================\n\n    private selectPlaceFromList(place: GeoJSON.Feature, index: number): void {\n        if (!this.options.showPlacesList) return;\n\n        // Built-in list doesn't track selection - just notify callback\n        this.callbacks.onPlaceSelect?.(place, index);\n    }\n\n    private async loadMorePlaces(): Promise<void> {\n        if (!this.currentCategory || this.isLoadingMorePlaces || !this.hasMorePlaces || !this.callbacks.onLoadMore) {\n            return;\n        }\n\n        this.isLoadingMorePlaces = true;\n        this.updateStatusBarState('loading');\n\n        try {\n            await this.callbacks.onLoadMore(\n                this.currentOffset\n            );\n\n            this.updateStatusBarState('end');\n        } catch (error) {\n            console.error('Failed to load more places:', error);\n            // Revert to button state on error\n            this.updateStatusBarState('button');\n        } finally {\n            this.isLoadingMorePlaces = false;\n        }\n    }\n\n    private setupScrollDetection(): void {\n        if (!this.scrollContainer || !this.hasMorePlaces) return;\n\n        // Remove existing listener to avoid duplicates\n        this.removeScrollListener();\n\n        // Create and attach new scroll listener\n        this.scrollListener = () => this.onScrollHandler();\n        this.scrollContainer.addEventListener('scroll', this.scrollListener);\n    }\n\n    private removeScrollListener(): void {\n        if (this.scrollListener && this.scrollContainer) {\n            this.scrollContainer.removeEventListener('scroll', this.scrollListener);\n            this.scrollListener = null;\n        }\n    }\n\n    private onScrollHandler(): void {\n        if (!this.scrollContainer || this.isLoadingMorePlaces || !this.hasMorePlaces) return;\n\n        const { scrollTop, scrollHeight, clientHeight } = this.scrollContainer;\n        const distanceFromBottom = scrollHeight - scrollTop - clientHeight;\n        const isAtBottom = distanceFromBottom <= 10;\n\n        if (isAtBottom) {\n            // Auto-load or show button when at bottom\n            if (this.options.enablePlacesLazyLoading) {\n                this.loadMorePlaces();\n            } else {\n                this.updateStatusBarState('button');\n            }\n        } else if (this.statusBar?.classList.contains('button')) {\n            // Hide button when scrolling away from bottom\n            this.updateStatusBarState('empty');\n        }\n    }\n}","import { CalculationHelper } from \"./helpers/calculation.helper\";\nimport { DomHelper } from \"./helpers/dom.helper\";\nimport {\n    BY_CIRCLE,\n    BY_COUNTRYCODE,\n    BY_GEOMETRY,\n    BY_PLACE,\n    BY_PROXIMITY,\n    BY_RECT\n} from \"./helpers/constants\";\nimport { Callbacks } from \"./helpers/callbacks\";\nimport { CategoryManager } from \"./helpers/category.helper\";\nimport { PlacesApiHelper } from './helpers/places-api.helper';\nimport { PlacesListManager, PlacesListCallbacks } from \"./helpers/places-list.helper\";\nimport { Category, GeocoderEventType } from \"./types/external\";\n\nexport class GeocoderAutocomplete {\n\n    private inputElement: HTMLInputElement;\n    private inputWrapper: HTMLElement;\n    private componentWrapper: HTMLElement;\n    private inputClearButton: HTMLElement;\n    private autocompleteItemsElement: HTMLElement = null;\n\n    /* Places list manager */\n    private placesListManager: PlacesListManager;\n\n    /* Focused item in the autocomplete list. This variable is used to navigate with buttons */\n    private focusedItemIndex: number;\n\n    /* Current autocomplete items data (GeoJSON.Feature) */\n    private currentItems: any;\n\n    /* Current categories displayed in dropdown */\n    private currentCategories: Category[] = [];\n\n    /* Active request promise reject function. To be able to cancel the promise when a new request comes */\n    private currentPromiseReject: any;\n\n    /* Active place details request promise reject function */\n    private currentPlaceDetailsPromiseReject: any;\n\n    /* We set timeout before sending a request to avoid unnecessary calls */\n    private currentTimeout: number;\n\n    private callbacks = new Callbacks();\n\n    private preprocessHook?: (value: string) => string;\n    private postprocessHook?: (feature: any) => string;\n    private suggestionsFilter?: (suggetions: any[]) => any[];\n\n    private sendGeocoderRequestAlt?: (value: string, geocoderAutocomplete: GeocoderAutocomplete) => Promise<any>;\n    private sendPlaceDetailsRequestAlt?: (feature: any, geocoderAutocomplete: GeocoderAutocomplete) => Promise<any>;\n    private sendPlacesRequestAlt?: (category: string[], offset: number, geocoderAutocomplete: GeocoderAutocomplete) => Promise<any>;\n\n    private geocoderUrl = \"https://api.geoapify.com/v1/geocode/autocomplete\";\n    private placeDetailsUrl = \"https://api.geoapify.com/v2/place-details\";\n    private placesApiUrl = \"https://api.geoapify.com/v2/places\";\n    private ipGeolocationUrl = \"https://api.geoapify.com/v1/ipinfo\";\n\n    private readonly categoryManager: CategoryManager;\n    private currentPlacesPromiseReject?: any;\n    private lastEscKeyTime?: number;\n    private readonly DOUBLE_ESC_THRESHOLD = 500; // 500ms window for double-Esc\n\n    private options: GeocoderAutocompleteOptions = {\n        limit: 5,\n        placesLimit: 20,\n        debounceDelay: 100\n    };\n\n    constructor(container: HTMLElement, private apiKey: string, options?: GeocoderAutocompleteOptions) {\n        this.constructOptions(options);\n\n        this.componentWrapper = document.createElement(\"div\");\n        this.componentWrapper.classList.add(\"geoapify-geocoder-autocomplete-container\");\n        container.appendChild(this.componentWrapper);\n\n        const cs = getComputedStyle(container);\n        const parentMaxH = cs.maxHeight; // 'none' | '400px' | ...\n        const parentH = cs.height;       // 'auto' | '123px' | ...\n\n        // Priority:\n        // 1. If parent has a max-height  inherit it\n        // 2. Else if parent has a fixed height  use 100%\n        // 3. Else  fallback to 400px\n        if (parentMaxH && parentMaxH !== 'none') {\n            this.componentWrapper.style.maxHeight = 'inherit';\n        } else if (parentH && parentH !== 'auto' && parentH !== '0px') {\n            this.componentWrapper.style.maxHeight = '100%';\n        } else {\n            this.componentWrapper.style.maxHeight = '400px';\n        }\n\n        this.inputElement = document.createElement(\"input\");\n        this.inputWrapper = DomHelper.createInputElement(this.inputElement, this.options, this.componentWrapper);\n        this.addClearButton();\n\n        this.addEventListeners();\n\n        this.categoryManager = new CategoryManager();\n\n        // Initialize places list manager with callbacks\n        const placesCallbacks: PlacesListCallbacks = {\n            onLoadMore: () => {\n                return this.resendPlacesRequestForMore(true /* append */);\n            },\n            onPlacesUpdate: (places: GeoJSON.Feature[]) => {\n                this.callbacks.notifyPlaces(places);\n            },\n            onPlaceSelect: (place: GeoJSON.Feature, index: number) => {\n                this.callbacks.notifyPlaceSelect(place, index);\n\n                // Auto-hide places list if option is enabled\n                if (this.options.hidePlacesListAfterSelect) {\n                    this.placesListManager.clearPlacesList();\n\n                    if (place && place.properties && place.properties.formatted) {\n                        this.clearCategory();\n                        this.setValue(place.properties.formatted);\n                    }\n                }\n            }\n        };\n        this.placesListManager = new PlacesListManager(this.componentWrapper, this.options, placesCallbacks);\n    }\n\n    public setType(type: 'country' | 'state' | 'city' | 'postcode' | 'street' | 'amenity' | null) {\n        this.options.type = type;\n    }\n\n    public setLang(lang: SupportedLanguage | null) {\n        this.options.lang = lang;\n    }\n\n    public setAddDetails(addDetails: boolean) {\n        this.options.addDetails = addDetails;\n    }\n\n    public setSkipIcons(skipIcons: boolean) {\n        this.options.skipIcons = skipIcons;\n    }\n\n    public setAllowNonVerifiedHouseNumber(allowNonVerifiedHouseNumber: boolean) {\n        this.options.allowNonVerifiedHouseNumber = allowNonVerifiedHouseNumber;\n    }\n\n    public setAllowNonVerifiedStreet(allowNonVerifiedStreet: boolean) {\n        this.options.allowNonVerifiedStreet = allowNonVerifiedStreet;\n    }\n\n    public setCountryCodes(codes: CountyCode[]) {\n        console.warn(\"WARNING! Obsolete function called. Function setCountryCodes() has been deprecated, please use the new addFilterByCountry() function instead!\");\n        this.options.countryCodes = codes;\n    }\n\n    public setPosition(position: GeoPosition) {\n        console.warn(\"WARNING! Obsolete function called. Function setPosition() has been deprecated, please use the new addBiasByProximity() function instead!\");\n        this.options.position = position;\n    }\n\n    public setLimit(limit: number) {\n        this.options.limit = limit;\n    }\n\n    public setPlacesLimit(limit: number) {\n        this.options.placesLimit = limit;\n    }\n\n    public setValue(value: string) {\n        if (!value) {\n            this.inputClearButton.classList.remove(\"visible\");\n        } else {\n            this.inputClearButton.classList.add(\"visible\");\n        }\n\n        this.inputElement.value = value;\n    }\n\n    public getValue() {\n        return this.inputElement.value;\n    }\n\n    public addFilterByCountry(codes: ByCountryCodeOptions) {\n        this.options.filter[BY_COUNTRYCODE] = codes;\n    }\n\n    public addFilterByCircle(filterByCircle: ByCircleOptions) {\n        this.options.filter[BY_CIRCLE] = filterByCircle;\n    }\n\n    public addFilterByRect(filterByRect: ByRectOptions) {\n        this.options.filter[BY_RECT] = filterByRect;\n    }\n\n    public addFilterByPlace(filterByPlace: string) {\n        this.options.filter[BY_PLACE] = filterByPlace;\n    }\n\n    public clearFilters() {\n        this.options.filter = {};\n    }\n\n    public addBiasByCountry(codes: ByCountryCodeOptions) {\n        this.options.bias[BY_COUNTRYCODE] = codes;\n    }\n\n    public addBiasByCircle(biasByCircle: ByCircleOptions) {\n        this.options.bias[BY_CIRCLE] = biasByCircle;\n    }\n\n    public addBiasByRect(biasByRect: ByRectOptions) {\n        this.options.bias[BY_RECT] = biasByRect;\n    }\n\n    public addBiasByProximity(biasByProximity: ByProximityOptions) {\n        this.options.bias[BY_PROXIMITY] = biasByProximity;\n    }\n\n    public clearBias() {\n        this.options.bias = {};\n    }\n\n    public setPlacesFilterByCircle(filterByCircle: ByCircleOptions) {\n        this.options.placesFilter[BY_CIRCLE] = filterByCircle;\n        this.placesListManager.setCurrentOffset(0);\n    }\n\n    public setPlacesFilterByRect(filterByRect: ByRectOptions) {\n        this.options.placesFilter[BY_RECT] = filterByRect;\n        this.placesListManager.setCurrentOffset(0);\n    }\n\n    public setPlacesFilterByPlace(filterByPlace: string) {\n        this.options.placesFilter[BY_PLACE] = filterByPlace;\n        this.placesListManager.setCurrentOffset(0);\n    }\n\n    public setPlacesFilterByGeometry(filterByGeometry: string) {\n        this.options.placesFilter[BY_GEOMETRY] = filterByGeometry;\n        this.placesListManager.setCurrentOffset(0);\n    }\n\n    public clearPlacesFilters() {\n        this.options.placesFilter = {};\n        this.placesListManager.setCurrentOffset(0);\n    }\n\n    public setPlacesBiasByCircle(biasByCircle: ByCircleOptions) {\n        this.options.placesBias[BY_CIRCLE] = biasByCircle;\n        this.placesListManager.setCurrentOffset(0);\n    }\n\n    public setPlacesBiasByRect(biasByRect: ByRectOptions) {\n        this.options.placesBias[BY_RECT] = biasByRect;\n        this.placesListManager.setCurrentOffset(0);\n    }\n\n    public setPlacesBiasByProximity(biasByProximity: ByProximityOptions) {\n        this.options.placesBias[BY_PROXIMITY] = biasByProximity;\n        this.placesListManager.setCurrentOffset(0);\n    }\n\n    public clearPlacesBias() {\n        this.options.placesBias = {};\n        this.placesListManager.setCurrentOffset(0);\n    }\n\n    public on(operation: GeocoderEventType, callback: (param: any) => void) {\n        this.callbacks.addCallback(operation, callback);\n    }\n\n    public off(operation: GeocoderEventType, callback?: (param: any) => any) {\n        this.callbacks.removeCallback(operation, callback);\n    }\n\n    public once(operation: GeocoderEventType, callback: (param: any) => any) {\n        this.on(operation, callback);\n\n        const current = this;\n        const currentListener = () => {\n            current.off(operation, callback);\n            current.off(operation, currentListener);\n        }\n\n        this.on(operation, currentListener);\n    }\n\n    public setSuggestionsFilter(suggestionsFilterFunc?: ((suggestions: any[]) => any[]) | null) {\n        this.suggestionsFilter = CalculationHelper.returnIfFunction(suggestionsFilterFunc);\n    }\n\n    public setPreprocessHook(preprocessHookFunc?: ((value: string) => string) | null) {\n        this.preprocessHook = CalculationHelper.returnIfFunction(preprocessHookFunc);\n    }\n\n    public setPostprocessHook(postprocessHookFunc?: ((value: string) => string) | null) {\n        this.postprocessHook = CalculationHelper.returnIfFunction(postprocessHookFunc);\n    }\n\n    public setSendGeocoderRequestFunc(sendGeocoderRequestFunc?: ((value: string, geocoderAutocomplete: GeocoderAutocomplete) => Promise<any>) | null) {\n        this.sendGeocoderRequestAlt = CalculationHelper.returnIfFunction(sendGeocoderRequestFunc);\n    }\n\n    public setSendPlaceDetailsRequestFunc(sendPlaceDetailsRequestFunc?: ((feature: any, geocoderAutocomplete: GeocoderAutocomplete) => Promise<any>) | null) {\n        this.sendPlaceDetailsRequestAlt = CalculationHelper.returnIfFunction(sendPlaceDetailsRequestFunc);\n    }\n\n    public setSendPlacesRequestFunc(\n        sendPlacesRequestFunc?: ((category: string[], offset: number, geocoderAutocomplete: GeocoderAutocomplete) => Promise<any> ) | null\n    ): void {\n        if (!this.isCategoryModeEnabled()) {\n            console.warn('Category search is disabled. Enable with addCategorySearch: true');\n            return;\n        }\n\n        this.sendPlacesRequestAlt = CalculationHelper.returnIfFunction(sendPlacesRequestFunc);\n    }\n\n    public isOpen(): boolean {\n        return !!this.autocompleteItemsElement;\n    }\n\n    public close() {\n        this.closeDropDownList();\n    }\n\n    public open() {\n        if (!this.isOpen()) {\n            this.openDropdownAgain();\n        }\n    }\n\n    private sendGeocoderRequestOrAlt(currentValue: string): Promise<any> {\n        if (this.sendGeocoderRequestAlt) {\n            return this.sendGeocoderRequestAlt(currentValue, this);\n        } else {\n            return this.sendGeocoderRequest(currentValue);\n        }\n\n    }\n\n    public sendGeocoderRequest(value: string): Promise<any> {\n        return new Promise((resolve, reject) => {\n            this.currentPromiseReject = reject;\n\n            let url = CalculationHelper.generateUrl(value, this.geocoderUrl, this.apiKey, this.options);\n\n            fetch(url)\n                .then((response) => {\n                    if (response.ok) {\n                        response.json().then(data => resolve(data));\n                    } else {\n                        response.json().then(data => reject(data));\n                    }\n                });\n        });\n    }\n\n    public sendPlaceDetailsRequest(feature: any): Promise<any> {\n        return new Promise((resolve, reject) => {\n\n            if (CalculationHelper.isNotOpenStreetMapData(feature)) {\n                // only OSM data has detailed information; return the original object if the source is different from OSM\n                resolve(feature);\n                return;\n            }\n\n            this.currentPlaceDetailsPromiseReject = reject;\n            let url = CalculationHelper.generatePlacesUrl(this.placeDetailsUrl, feature.properties.place_id, this.apiKey, this.options);\n\n            fetch(url)\n                .then((response) => {\n                    if (response.ok) {\n                        response.json().then(data => {\n                            if (!data.features.length) {\n                                resolve(feature);\n                            }\n\n                            resolve(data.features[0]);\n                        });\n                    } else {\n                        response.json().then(data => reject(data));\n                    }\n                });\n        });\n    }\n\n    public async selectCategory(category: Category | string | string[] | null): Promise<void> {\n        if (category) {\n            this.categoryManager.setCategory(category);\n            const categoryObj = this.categoryManager.getCategory();\n\n            if (!categoryObj) {\n                return;\n            }\n\n            this.inputElement.value = categoryObj.label;\n            this.showClearButton();\n\n            // Close the dropdown when a category is selected\n            this.closeDropDownList();\n\n            this.placesListManager.setCategory(categoryObj.keys, categoryObj.label);\n            this.placesListManager.setCurrentOffset(0);\n\n            await this.sendPlacesRequest();\n        } else {\n            this.clearCategoryAndNotify();\n        }\n    }\n\n    public async clearCategory() {\n        this.clearCategoryAndNotify();\n    }\n\n    public async resendPlacesRequestForMore(\n        appendPlaces?: boolean\n    ): Promise<void> {\n        const categoryObj = this.categoryManager.getCategory();\n\n        if (!categoryObj) {\n            console.warn('Cannot resend places request: no category is set');\n            return;\n        }\n\n        this.callbacks.notifyPlacesRequestStart(categoryObj);\n\n        if (!appendPlaces) {\n            this.placesListManager.setCurrentOffset(0);   \n        }\n\n        try {\n            const bias = Object.keys(this.options.placesBias).length ? this.options.placesBias : PlacesApiHelper.convertGeocoderBiasToPlacesApiBias(this.options.bias);\n            const filter = Object.keys(this.options.placesFilter).length ? this.options.placesFilter : PlacesApiHelper.convertGeocoderFilterToPlacesApiFilter(this.options.filter);\n\n            const data = await this.sendPlacesRequestOrAlt(categoryObj.keys,\n                bias,\n                filter,\n                this.placesListManager.getCurrentOffset(), this.options.placesLimit);\n            \n            const places = data.features || [];\n\n            this.placesListManager.setPlaces(places, appendPlaces);\n            this.placesListManager.setCurrentOffset(this.placesListManager.getCurrentOffset() + this.options.placesLimit);\n            this.callbacks.notifyPlacesRequestEnd(true, data);\n        } catch (error) {\n            this.callbacks.notifyPlacesRequestEnd(false, null, error);\n            console.error('Places API request failed:', error);\n        }\n    }\n\n    public getCategory(): Category | null {\n        if (!this.isCategoryModeEnabled()) {\n            return null;\n        }\n\n        return this.categoryManager.getCategory();\n    }\n\n    public selectPlace(index: number | null): void {\n        // Only works with built-in places list\n        if (!this.options.showPlacesList) {\n            return;\n        }\n\n        // If index is null or negative, clear selection\n        if (index === null || index < 0) {\n            this.placesListManager.clearSelection();\n            return;\n        }\n\n        // Select the place (no validation - let the user manage that)\n        this.placesListManager.selectPlace(index);\n    }\n\n    public async sendPlacesRequest(): Promise<void> {\n\n        const categoryObj = this.categoryManager.getCategory();\n\n        if (!this.isCategoryModeEnabled()) {\n            return Promise.reject(new Error('Category search is disabled'));\n        }\n\n        if (!categoryObj) {\n            console.warn('Cannot resend places request: no category is set');\n            return;\n        }\n\n        this.callbacks.notifyPlacesRequestStart(categoryObj);\n        let data;\n\n        try {\n\n            const bias = Object.keys(this.options.placesBias).length ? this.options.placesBias : PlacesApiHelper.convertGeocoderBiasToPlacesApiBias(this.options.bias);\n            const filter = Object.keys(this.options.placesFilter).length ? this.options.placesFilter : PlacesApiHelper.convertGeocoderFilterToPlacesApiFilter(this.options.filter);\n\n\n            data = await this.sendPlacesRequestOrAlt(this.categoryManager.getCategory().keys,\n                bias,\n                filter,\n                0,\n                this.options.placesLimit);\n\n            const places = data.features;\n\n            this.placesListManager.setPlaces(places);\n            this.placesListManager.setCurrentOffset(this.placesListManager.getCurrentOffset() + this.options.placesLimit);\n            this.callbacks.notifyPlacesRequestEnd(true, data);\n        } catch (error) {\n            this.callbacks.notifyPlacesRequestEnd(false, null, error);\n            console.error('Places API request failed:', error);\n        }\n    }\n\n    /* Execute a function when someone writes in the text field: */\n    onUserInput(event: Event) {\n        let currentValue = this.inputElement.value;\n        let userEnteredValue = this.inputElement.value;\n\n        this.callbacks.notifyInputChange(currentValue);\n\n        /* Reset category mode and clear places list when user types */\n        this.clearCategoryAndNotify();\n\n        /* Close any already open dropdown list */\n        this.closeDropDownList();\n\n        this.focusedItemIndex = -1;\n\n        this.cancelPreviousRequest();\n\n        this.cancelPreviousTimeout();\n\n        if (!currentValue) {\n            this.removeClearButton();\n            return false;\n        }\n\n        this.showClearButton();\n\n        this.currentTimeout = window.setTimeout(() => {\n            /* Create a new promise and send geocoding request */\n            if (CalculationHelper.returnIfFunction(this.preprocessHook)) {\n                currentValue = this.preprocessHook(currentValue);\n            }\n\n            this.callbacks.notifyRequestStart(currentValue);\n\n            let promise = this.sendGeocoderRequestOrAlt(currentValue);\n\n            promise.then((data: any) => {\n                this.callbacks.notifyRequestEnd(true, data);\n                this.onDropdownDataLoad(data, userEnteredValue, event);\n            }, (err) => {\n                this.callbacks.notifyRequestEnd(false, null, err);\n                if (!err.canceled) {\n                    console.log(err);\n                }\n            });\n        }, this.options.debounceDelay);\n    }\n\n    private onDropdownDataLoad(data: any, userEnteredValue: string, event: Event) {\n        if (CalculationHelper.needToCalculateExtendByNonVerifiedValues(data, this.options)) {\n            CalculationHelper.extendByNonVerifiedValues(this.options, data.features, data?.query?.parsed);\n        }\n\n        this.currentItems = data.features;\n\n        if (CalculationHelper.needToFilterDataBySuggestionsFilter(this.currentItems, this.suggestionsFilter)) {\n            this.currentItems = this.suggestionsFilter(this.currentItems);\n        }\n\n        this.callbacks.notifySuggestions(this.currentItems);\n\n        this.currentCategories = [];\n        if (this.isCategoryModeEnabled() && data.query?.categories) {\n            this.currentCategories = this.categoryManager.extractCategoriesFromResponse(data);\n        }\n\n        if (!this.currentItems.length && !this.currentCategories.length) {\n            return;\n        }\n\n        this.createDropdown();\n\n        this.currentCategories.forEach((category: Category) => {\n            this.populateCategoryDropdownItem(category, event);\n        });\n\n        this.currentItems.forEach((feature: any, index: number) => {\n            this.populateDropdownItem(feature, userEnteredValue, event, index + this.currentCategories.length);\n        });\n    }\n\n    private populateCategoryDropdownItem(category: Category, event: Event) {\n        const itemElement = DomHelper.createDropdownItem();\n        itemElement.classList.add('geoapify-category-item');\n\n        // Add search icon\n        const iconElement = document.createElement(\"span\");\n        iconElement.classList.add('icon');\n        DomHelper.addIcon(iconElement, 'search');\n        itemElement.appendChild(iconElement);\n\n        const textElement = DomHelper.createDropdownItemText();\n        textElement.innerHTML = `<span class=\"main-part\">${category.label}</span>`;\n        itemElement.appendChild(textElement);\n\n        itemElement.addEventListener(\"click\", (e) => {\n            event.stopPropagation();\n            this.selectCategory(category);\n        });\n\n        this.autocompleteItemsElement?.appendChild(itemElement);\n    }\n\n    private populateDropdownItem(feature: any, userEnteredValue: string, event: Event, index: number) {\n        /* Create a DIV element for each element: */\n        const itemElement = DomHelper.createDropdownItem();\n\n        if (!this.options.skipIcons) {\n            DomHelper.addDropdownIcon(feature, itemElement);\n        }\n\n        const textElement = DomHelper.createDropdownItemText();\n\n        if (CalculationHelper.returnIfFunction(this.postprocessHook)) {\n            const value = this.postprocessHook(feature);\n            textElement.innerHTML = DomHelper.getStyledAddressSingleValue(value, userEnteredValue);\n        } else {\n            textElement.innerHTML = DomHelper.getStyledAddress(feature.properties, userEnteredValue);\n        }\n\n        itemElement.appendChild(textElement);\n        this.addEventListenerOnDropdownClick(itemElement, event, index);\n        this.autocompleteItemsElement.appendChild(itemElement);\n    }\n\n    private addEventListenerOnDropdownClick(itemElement: HTMLDivElement, event: Event, index: number) {\n        itemElement.addEventListener(\"click\", (e) => {\n            event.stopPropagation();\n\n            let featureIndex = index;\n            if (this.isCategoryModeEnabled()) {\n                const categoryCount = this.autocompleteItemsElement?.querySelectorAll('.geoapify-category-item').length || 0;\n                featureIndex = index - categoryCount;\n            }\n\n            if (this.currentItems?.[featureIndex]) {\n                this.setValueAndNotify(this.currentItems[featureIndex]);\n            }\n        });\n    }\n\n    private createDropdown() {\n        /*create a DIV element that will contain the items (values):*/\n        this.autocompleteItemsElement = document.createElement(\"div\");\n        this.autocompleteItemsElement.setAttribute(\"class\", \"geoapify-autocomplete-items\");\n\n        this.callbacks.notifyOpened();\n\n        /* Append the DIV element as a child of the input wrapper:*/\n        this.componentWrapper.appendChild(this.autocompleteItemsElement);\n    }\n\n    private cancelPreviousTimeout() {\n        if (this.currentTimeout) {\n            window.clearTimeout(this.currentTimeout);\n            this.currentTimeout = null;\n        }\n    }\n\n    private cancelPreviousRequest() {\n        if (this.currentPromiseReject) {\n            this.currentPromiseReject({\n                canceled: true\n            });\n            this.currentPromiseReject = null;\n        }\n    }\n\n    private addEventListeners() {\n        this.inputElement.addEventListener('input', this.onUserInput.bind(this), false);\n        this.inputElement.addEventListener('keydown', this.onUserKeyPress.bind(this), false);\n\n        document.addEventListener(\"click\", (event) => {\n            if (event.target !== this.inputElement) {\n                this.closeDropDownList();\n            } else if (!this.autocompleteItemsElement) {\n                // open dropdown list again\n                this.openDropdownAgain();\n            }\n        });\n    }\n\n    private showClearButton() {\n        this.inputClearButton.classList.add(\"visible\");\n    }\n\n    private removeClearButton() {\n        this.inputClearButton.classList.remove(\"visible\");\n    }\n\n    private onUserKeyPress(event: KeyboardEvent) {\n        if (this.autocompleteItemsElement) {\n            const itemElements: HTMLCollectionOf<HTMLDivElement> = this.autocompleteItemsElement.getElementsByTagName(\"div\");\n            if (event.code === 'ArrowDown') {\n                this.handleArrowDownEvent(event, itemElements);\n            } else if (event.code === 'ArrowUp') {\n                this.handleArrowUpEvent(event, itemElements);\n            } else if (event.code === \"Enter\") {\n                this.handleEnterEvent(event);\n            } else if (event.code === \"Escape\") {\n                /* If the ESC key is pressed, close the list */\n                this.handleEscapeKey();\n            }\n        } else {\n            if (event.code == 'ArrowDown') {\n                /* Open dropdown list again */\n                this.openDropdownAgain();\n            } else if (event.code === \"Escape\") {\n                /* Handle Esc when dropdown is closed (for double-Esc category clearing) */\n                this.handleEscapeKey();\n            }\n        }\n    }\n\n    private handleEscapeKey(): void {\n        const now = Date.now();\n\n        if (this.autocompleteItemsElement) {\n            // First Esc: Close dropdown\n            this.closeDropDownList();\n            this.lastEscKeyTime = now;\n        } else if (this.shouldClearCategoryOnDoubleEscape(now)) {\n            // Second Esc within threshold: Clear category and reset input\n            this.inputElement.value = '';\n            this.removeClearButton();\n            this.clearCategory();\n            this.lastEscKeyTime = undefined;\n        } else {\n            // Single Esc when dropdown is already closed\n            this.lastEscKeyTime = now;\n        }\n    }\n\n    private shouldClearCategoryOnDoubleEscape(currentTime: number): boolean {\n        return this.isCategoryModeEnabled() &&\n            this.categoryManager.isCategoryModeActive() &&\n            this.lastEscKeyTime !== undefined &&\n            (currentTime - this.lastEscKeyTime) < this.DOUBLE_ESC_THRESHOLD;\n    }\n\n    private handleEnterEvent(event: KeyboardEvent) {\n        /* If the ENTER key is pressed and value as selected, close the list*/\n        event.preventDefault();\n        if (this.focusedItemIndex > -1) {\n            const categoryCount = this.currentCategories.length;\n\n            // Check if the focused item is a category\n            if (this.focusedItemIndex < categoryCount) {\n                // It's a category - trigger setCategory\n                const category = this.currentCategories[this.focusedItemIndex];\n                this.selectCategory(category);\n            } else {\n                // It's a regular geocoder item\n                const itemIndex = this.focusedItemIndex - categoryCount;\n                if (this.options.skipSelectionOnArrowKey) {\n                    // select the location if it wasn't selected by navigation\n                    this.setValueAndNotify(this.currentItems[itemIndex]);\n                } else {\n                    this.closeDropDownList();\n                }\n            }\n        }\n    }\n\n    private handleArrowUpEvent(event: KeyboardEvent, itemElements: HTMLCollectionOf<HTMLDivElement>) {\n        event.preventDefault();\n\n        /*If the arrow UP key is pressed, decrease the focusedItemIndex variable:*/\n        this.focusedItemIndex--;\n        if (this.focusedItemIndex < 0) this.focusedItemIndex = (itemElements.length - 1);\n        /*and and make the current item more visible:*/\n        this.setActive(itemElements, this.focusedItemIndex);\n    }\n\n    private handleArrowDownEvent(event: KeyboardEvent, itemElements: HTMLCollectionOf<HTMLDivElement>) {\n        event.preventDefault();\n\n        /*If the arrow DOWN key is pressed, increase the focusedItemIndex variable:*/\n        this.focusedItemIndex++;\n        if (this.focusedItemIndex >= itemElements.length) this.focusedItemIndex = 0;\n        /*and and make the current item more visible:*/\n        this.setActive(itemElements, this.focusedItemIndex);\n    }\n\n    private setActive(items: HTMLCollectionOf<HTMLDivElement>, index: number) {\n        if (!items || !items.length) return false;\n        DomHelper.addActiveClassToDropdownItem(items, index);\n\n        if (!this.options.skipSelectionOnArrowKey) {\n            const categoryCount = this.currentCategories.length;\n\n            // Check if the focused item is a category\n            if (index < categoryCount) {\n                // It's a category item\n                const category = this.currentCategories[index];\n                this.inputElement.value = category.label;\n            } else {\n                // It's a regular geocoder item\n                const itemIndex = index - categoryCount;\n                if (CalculationHelper.returnIfFunction(this.postprocessHook)) {\n                    this.inputElement.value = this.postprocessHook(this.currentItems[itemIndex]);\n                } else {\n                    this.inputElement.value = this.currentItems[itemIndex].properties.formatted;\n                }\n                this.notifyValueSelected(this.currentItems[itemIndex]);\n            }\n        }\n    }\n\n    private setValueAndNotify(feature: any) {\n        if (CalculationHelper.returnIfFunction(this.postprocessHook)) {\n            this.inputElement.value = this.postprocessHook(feature);\n        } else {\n            this.inputElement.value = feature.properties.formatted;\n        }\n\n        // Clear category when selecting a regular place from main dropdown\n        this.clearCategoryAndNotify();\n\n        this.notifyValueSelected(feature);\n\n        /* Close the list of autocompleted values: */\n        this.closeDropDownList();\n    }\n\n    private clearFieldAndNotify(event: MouseEvent) {\n        event.stopPropagation();\n        this.inputElement.value = '';\n        this.removeClearButton();\n\n        this.cancelPreviousRequest();\n\n        this.cancelPreviousTimeout();\n        this.cancelCurrentPlacesRequest();\n        this.closeDropDownList();\n\n        if (this.isCategoryModeEnabled() && this.categoryManager.isCategoryModeActive()) {\n            this.clearCategoryAndNotify();\n        } else {\n            this.callbacks.notifyClear('address');\n        }\n\n        this.notifyValueSelected(null);\n    }\n\n    private closeDropDownList() {\n        if (this.autocompleteItemsElement) {\n            this.componentWrapper.removeChild(this.autocompleteItemsElement);\n            this.autocompleteItemsElement = null;\n            this.callbacks.notifyClosed();\n        }\n    }\n\n    private notifyValueSelected(feature: any) {\n        this.cancelPreviousPlaceDetailsRequest();\n\n        if (this.noNeedToRequestPlaceDetails(feature)) {\n            this.callbacks.notifyChange(feature);\n        } else {\n            this.callbacks.notifyPlaceDetailsRequestStart(feature);\n\n            let promise = this.sendPlaceDetailsRequestOrAlt(feature);\n\n            promise.then((detailesFeature: any) => {\n                this.callbacks.notifyPlaceDetailsRequestEnd(true, detailesFeature);\n                this.callbacks.notifyChange(detailesFeature);\n                this.currentPlaceDetailsPromiseReject = null;\n            }, (err) => {\n                if (!err.canceled) {\n                    console.log(err);\n                    this.callbacks.notifyPlaceDetailsRequestEnd(false, null, err);\n                    this.callbacks.notifyChange(feature);\n                    this.currentPlaceDetailsPromiseReject = null;\n                }\n            });\n        }\n    }\n\n    private sendPlaceDetailsRequestOrAlt(feature: any) {\n        if (this.sendPlaceDetailsRequestAlt) {\n            return this.sendPlaceDetailsRequestAlt(feature, this)\n        } else {\n            return this.sendPlaceDetailsRequest(feature);\n        }\n    }\n\n    private noNeedToRequestPlaceDetails(feature: any) {\n        return !this.options.addDetails || !feature || feature.properties.nonVerifiedParts?.length;\n    }\n\n    private cancelPreviousPlaceDetailsRequest() {\n        if (this.currentPlaceDetailsPromiseReject) {\n            this.currentPlaceDetailsPromiseReject({\n                canceled: true\n            });\n            this.currentPlaceDetailsPromiseReject = null;\n        }\n    }\n\n    private cancelCurrentPlacesRequest() {\n        if (this.currentPlacesPromiseReject) {\n            this.currentPlacesPromiseReject({ canceled: true });\n            this.currentPlacesPromiseReject = null;\n        }\n    }\n\n    private openDropdownAgain() {\n        const event = document.createEvent('Event');\n        event.initEvent('input', true, true);\n        this.inputElement.dispatchEvent(event);\n    }\n\n    private constructOptions(options: GeocoderAutocompleteOptions) {\n        this.options = options ? { ...this.options, ...options } : this.options;\n        this.options.filter = this.options.filter || {};\n        this.options.bias = this.options.bias || {};\n\n        this.options.placesFilter = this.options.placesFilter || {};\n        this.options.placesBias = this.options.placesBias || {};\n\n        if (this.options.countryCodes) {\n            this.addFilterByCountry(this.options.countryCodes);\n        }\n\n        if (this.options.position) {\n            this.addBiasByProximity(this.options.position);\n        }\n    }\n\n    private addClearButton() {\n        this.inputClearButton = document.createElement(\"div\");\n        this.inputClearButton.classList.add(\"geoapify-close-button\");\n        DomHelper.addIcon(this.inputClearButton, 'close');\n        this.inputClearButton.addEventListener(\"click\", this.clearFieldAndNotify.bind(this), false);\n        this.inputWrapper.appendChild(this.inputClearButton);\n    }\n\n    private isCategoryModeEnabled(): boolean {\n        return !!this.options.addCategorySearch;\n    }\n\n    private clearCategoryAndNotify(): void {\n        if (!this.isCategoryModeEnabled()) return;\n\n        const wasCategoryActive = this.categoryManager.isCategoryModeActive();\n        this.categoryManager.clearCategory();\n        this.placesListManager.resetCategory();\n\n        if (wasCategoryActive) {\n            this.callbacks.notifyClear('category');\n        }\n    }\n\n    private async sendPlacesRequestOrAlt(\n        categoryKeys: string[],\n        bias?: { [key: string]: ByProximityOptions | ByCircleOptions | ByRectOptions },\n        filter?: { [key: string]: ByCircleOptions | ByRectOptions | string },\n        offset?: number,\n        limit?: number\n    ): Promise<any> {\n        if (this.sendPlacesRequestAlt) {\n            return this.sendPlacesRequestAlt(categoryKeys, offset, this);\n        }\n\n        let url;\n        if (Object.keys(bias || {}).length === 0 && Object.keys(filter || {}).length === 0) {\n            const location = await PlacesApiHelper.getLocationForBias(this.apiKey, this.options, this.ipGeolocationUrl);\n            url = PlacesApiHelper.generatePlacesUrl(\n                categoryKeys,\n                this.apiKey,\n                this.options,\n                this.placesApiUrl,\n                offset,\n                limit,\n                location ? { [BY_PROXIMITY]: location } : undefined\n            );\n        } else {\n            url = PlacesApiHelper.generatePlacesUrl(\n                categoryKeys,\n                this.apiKey,\n                this.options,\n                this.placesApiUrl,\n                offset,\n                limit,\n                bias,\n                filter\n            );\n        }\n\n        return PlacesApiHelper.sendPlacesRequest(url);\n    }\n\n}\n\nexport interface GeocoderAutocompleteOptions {\n    type?: LocationType;\n    lang?: SupportedLanguage;\n    limit?: number;\n    placeholder?: string;\n    debounceDelay?: number;\n\n    filter?: { [key: string]: ByCircleOptions | ByCountryCodeOptions | ByRectOptions | string },\n    bias?: { [key: string]: ByCircleOptions | ByCountryCodeOptions | ByRectOptions | ByProximityOptions },\n\n    skipIcons?: boolean;\n\n    /**\n     * @deprecated The property should not be used; it is true by default. Use the addDetails property to add details.\n     */\n    skipDetails?: boolean;\n\n    addDetails?: boolean;\n\n    skipSelectionOnArrowKey?: boolean;\n\n    // to remove in the next version\n    position?: GeoPosition;\n    countryCodes?: CountyCode[];\n\n    // extend results with non verified values if needed\n    allowNonVerifiedHouseNumber?: boolean;\n    allowNonVerifiedStreet?: boolean;\n\n    // places related options\n    addCategorySearch?: boolean;\n    showPlacesList?: boolean;\n    hidePlacesListAfterSelect?: boolean;\n    enablePlacesLazyLoading?: boolean;\n    placesLimit?: number;\n\n    placesFilter?: { [key: string]: ByCircleOptions | ByRectOptions | string },\n    placesBias?: { [key: string]: ByCircleOptions | ByRectOptions | ByProximityOptions },\n}\n\nexport interface GeoPosition {\n    lat: number;\n    lon: number;\n}\n\nexport type ByCountryCodeOptions = CountyCode[];\n\nexport interface ByProximityOptions {\n    lon: number;\n    lat: number;\n}\n\nexport interface ByCircleOptions {\n    lon: number;\n    lat: number;\n    radiusMeters: number;\n}\n\nexport interface ByRectOptions {\n    lon1: number;\n    lat1: number;\n    lon2: number;\n    lat2: number;\n}\n\nexport type LocationType = 'country' | 'state' | 'city' | 'postcode' | 'street' | 'amenity';\nexport type SupportedLanguage = \"ab\" | \"aa\" | \"af\" | \"ak\" | \"sq\" | \"am\" | \"ar\" | \"an\" | \"hy\" | \"as\" | \"av\" | \"ae\" | \"ay\" | \"az\" | \"bm\" | \"ba\" | \"eu\" | \"be\" | \"bn\" | \"bh\" | \"bi\" | \"bs\" | \"br\" | \"bg\" | \"my\" | \"ca\" | \"ch\" | \"ce\" | \"ny\" | \"zh\" | \"cv\" | \"kw\" | \"co\" | \"cr\" | \"hr\" | \"cs\" | \"da\" | \"dv\" | \"nl\" | \"en\" | \"eo\" | \"et\" | \"ee\" | \"fo\" | \"fj\" | \"fi\" | \"fr\" | \"ff\" | \"gl\" | \"ka\" | \"de\" | \"el\" | \"gn\" | \"gu\" | \"ht\" | \"ha\" | \"he\" | \"hz\" | \"hi\" | \"ho\" | \"hu\" | \"ia\" | \"id\" | \"ie\" | \"ga\" | \"ig\" | \"ik\" | \"io\" | \"is\" | \"it\" | \"iu\" | \"ja\" | \"jv\" | \"kl\" | \"kn\" | \"kr\" | \"ks\" | \"kk\" | \"km\" | \"ki\" | \"rw\" | \"ky\" | \"kv\" | \"kg\" | \"ko\" | \"ku\" | \"kj\" | \"la\" | \"lb\" | \"lg\" | \"li\" | \"ln\" | \"lo\" | \"lt\" | \"lu\" | \"lv\" | \"gv\" | \"mk\" | \"mg\" | \"ms\" | \"ml\" | \"mt\" | \"mi\" | \"mr\" | \"mh\" | \"mn\" | \"na\" | \"nv\" | \"nb\" | \"nd\" | \"ne\" | \"ng\" | \"nn\" | \"no\" | \"ii\" | \"nr\" | \"oc\" | \"oj\" | \"cu\" | \"om\" | \"or\" | \"os\" | \"pa\" | \"pi\" | \"fa\" | \"pl\" | \"ps\" | \"pt\" | \"qu\" | \"rm\" | \"rn\" | \"ro\" | \"ru\" | \"sa\" | \"sc\" | \"sd\" | \"se\" | \"sm\" | \"sg\" | \"sr\" | \"gd\" | \"sn\" | \"si\" | \"sk\" | \"sl\" | \"so\" | \"st\" | \"es\" | \"su\" | \"sw\" | \"ss\" | \"sv\" | \"ta\" | \"te\" | \"tg\" | \"th\" | \"ti\" | \"bo\" | \"tk\" | \"tl\" | \"tn\" | \"to\" | \"tr\" | \"ts\" | \"tt\" | \"tw\" | \"ty\" | \"ug\" | \"uk\" | \"ur\" | \"uz\" | \"ve\" | \"vi\" | \"vo\" | \"wa\" | \"cy\" | \"wo\" | \"fy\" | \"xh\" | \"yi\" | \"yo\" | \"za\";\nexport type CountyCode = \"none\" | \"auto\" | \"ad\" | \"ae\" | \"af\" | \"ag\" | \"ai\" | \"al\" | \"am\" | \"an\" | \"ao\" | \"ap\" | \"aq\" | \"ar\" | \"as\" | \"at\" | \"au\" | \"aw\" | \"az\" | \"ba\" | \"bb\" | \"bd\" | \"be\" | \"bf\" | \"bg\" | \"bh\" | \"bi\" | \"bj\" | \"bm\" | \"bn\" | \"bo\" | \"br\" | \"bs\" | \"bt\" | \"bv\" | \"bw\" | \"by\" | \"bz\" | \"ca\" | \"cc\" | \"cd\" | \"cf\" | \"cg\" | \"ch\" | \"ci\" | \"ck\" | \"cl\" | \"cm\" | \"cn\" | \"co\" | \"cr\" | \"cu\" | \"cv\" | \"cx\" | \"cy\" | \"cz\" | \"de\" | \"dj\" | \"dk\" | \"dm\" | \"do\" | \"dz\" | \"ec\" | \"ee\" | \"eg\" | \"eh\" | \"er\" | \"es\" | \"et\" | \"eu\" | \"fi\" | \"fj\" | \"fk\" | \"fm\" | \"fo\" | \"fr\" | \"ga\" | \"gb\" | \"gd\" | \"ge\" | \"gf\" | \"gh\" | \"gi\" | \"gl\" | \"gm\" | \"gn\" | \"gp\" | \"gq\" | \"gr\" | \"gs\" | \"gt\" | \"gu\" | \"gw\" | \"gy\" | \"hk\" | \"hm\" | \"hn\" | \"hr\" | \"ht\" | \"hu\" | \"id\" | \"ie\" | \"il\" | \"in\" | \"io\" | \"iq\" | \"ir\" | \"is\" | \"it\" | \"jm\" | \"jo\" | \"jp\" | \"ke\" | \"kg\" | \"kh\" | \"ki\" | \"km\" | \"kn\" | \"kp\" | \"kr\" | \"kw\" | \"ky\" | \"kz\" | \"la\" | \"lb\" | \"lc\" | \"li\" | \"lk\" | \"lr\" | \"ls\" | \"lt\" | \"lu\" | \"lv\" | \"ly\" | \"ma\" | \"mc\" | \"md\" | \"me\" | \"mg\" | \"mh\" | \"mk\" | \"ml\" | \"mm\" | \"mn\" | \"mo\" | \"mp\" | \"mq\" | \"mr\" | \"ms\" | \"mt\" | \"mu\" | \"mv\" | \"mw\" | \"mx\" | \"my\" | \"mz\" | \"na\" | \"nc\" | \"ne\" | \"nf\" | \"ng\" | \"ni\" | \"nl\" | \"no\" | \"np\" | \"nr\" | \"nu\" | \"nz\" | \"om\" | \"pa\" | \"pe\" | \"pf\" | \"pg\" | \"ph\" | \"pk\" | \"pl\" | \"pm\" | \"pr\" | \"ps\" | \"pt\" | \"pw\" | \"py\" | \"qa\" | \"re\" | \"ro\" | \"rs\" | \"ru\" | \"rw\" | \"sa\" | \"sb\" | \"sc\" | \"sd\" | \"se\" | \"sg\" | \"sh\" | \"si\" | \"sj\" | \"sk\" | \"sl\" | \"sm\" | \"sn\" | \"so\" | \"sr\" | \"st\" | \"sv\" | \"sy\" | \"sz\" | \"tc\" | \"td\" | \"tf\" | \"tg\" | \"th\" | \"tj\" | \"tk\" | \"tm\" | \"tn\" | \"to\" | \"tr\" | \"tt\" | \"tv\" | \"tw\" | \"tz\" | \"ua\" | \"ug\" | \"um\" | \"us\" | \"uy\" | \"uz\" | \"va\" | \"vc\" | \"ve\" | \"vg\" | \"vi\" | \"vn\" | \"vu\" | \"wf\" | \"ws\" | \"ye\" | \"yt\" | \"za\" | \"zm\" | \"zw\";\n"],"names":["BY_COUNTRYCODE","BY_RECT","BY_CIRCLE","BY_PROXIMITY","BY_PLACE","CalculationHelper","isLatitude","num","isFinite","Math","abs","isLongitude","isNotOpenStreetMapData","feature","properties","datasource","sourcename","place_id","extendByNonVerifiedValues","options","features","parsedAddress","forEach","housenumber","allowNonVerifiedHouseNumber","rank","match_type","this","addHouseNumberToFormatted","nonVerifiedParts","street","allowNonVerifiedStreet","replace","m","toUpperCase","address_line1","address_line2","formatted","featureProperties","houseNumberAndStreetFormatsPerCountry","format","Object","keys","find","key","indexOf","country_code","addressPart","generatePlacesUrl","placeDetailsUrl","placeId","apiKey","url","lang","needToFilterDataBySuggestionsFilter","currentItems","suggestionsFilter","length","needToCalculateExtendByNonVerifiedValues","data","query","parsed","generateUrl","value","geocoderUrl","encodeURIComponent","type","limit","filters","filterByCountryCodes","filter","filterByCircle","filterByRect","filterByPlace","push","join","toLowerCase","lat","lon","radiusMeters","lat1","lon1","lat2","lon2","bias","biasByCountryCodes","biasByCircle","biasByRect","biasByProximity","returnIfFunction","func","DomHelper","createInputElement","inputElement","container","classList","add","setAttribute","placeholder","inputWrapper","document","createElement","appendChild","addFeatureIcon","element","countryCode","iconMap","unknown","amenity","building","suburb","district","postcode","city","county","state","countryData","countiesData","code","emojiElement","innerText","emoji","addIcon","icon","icons","close","path","viewbox","road","spinner","clock","search","ban","svgElement","createElementNS","iconElement","addSpinnerIcon","getStyledAddressSingleValue","currentValue","displayValue","valueIndex","substring","getStyledAddress","mainPart","secondaryPart","parts","split","map","part","trim","name","slice","mainElements","min","max","addDropdownIcon","itemElement","result_type","addActiveClassToDropdownItem","items","index","i","remove","createDropdownItemText","textElement","createDropdownItem","Callbacks","changeCallbacks","suggestionsChangeCallbacks","inputCallbacks","openCallbacks","closeCallbacks","requestStartCallbacks","requestEndCallbacks","placesCallbacks","placesRequestStartCallbacks","placesRequestEndCallbacks","placeDetailsRequestStartCallbacks","placeDetailsRequestEndCallbacks","placeSelectCallbacks","clearCallbacks","addCallback","operation","callback","currentCallbacks","getCallbacksByOperation","removeCallback","splice","setCallbacksByOperation","notifyInputChange","notifyChange","notifySuggestions","notifyOpened","notifyClosed","notifyRequestStart","notifyRequestEnd","success","error","notifyPlaces","places","notifyPlacesRequestStart","category","notifyPlacesRequestEnd","notifyPlaceDetailsRequestStart","place","notifyPlaceDetailsRequestEnd","notifyPlaceSelect","notifyClear","itemType","callbacks","CategoryManager","selectedCategory","isCategoryMode","setCategory","label","Array","isArray","clearCategory","getCategory","isCategoryModeActive","extractCategoriesFromResponse","categories","cat","PlacesApiHelper","placesApiUrl","offset","c","undefined","effectiveFilter","convertGeocoderFilterToPlacesApiFilter","generatePlacesApiFilterString","effectiveBias","convertGeocoderBiasToPlacesApiBias","biasString","generatePlacesApiBiasString","sendPlacesRequest","Promise","resolve","reject","fetch","then","response","ok","json","catch","getLocationForBias","ipGeolocationUrl","existingProximity","ipUrl","location","latitude","longitude","console","warn","placesApiBias","placesApiFilter","biases","PlacesListManager","placesListElement","titleBar","scrollContainer","statusBar","loadMoreElement","currentOffset","currentCategory","currentCategoryLabel","isLoadingMorePlaces","hasMorePlaces","scrollListener","selectedPlaceIndex","constructor","setCurrentOffset","getCurrentOffset","categoryLabel","showPlacesList","placesToRender","isLoadMore","createPlacesElements","showEmptyState","updateStatusBar","showList","renderPlaces","updateStatusBarState","setupScrollDetection","filterDuplicatePlaces","newPlaces","existingPlaceIds","Set","id","has","setPlaces","append","placesLimit","clearPlacesItems","updateTitleBar","onPlacesUpdate","getPlaces","clearPlacesList","innerHTML","removeScrollListener","resetPaginationState","isPlacesListVisible","contains","resetCategory","selectPlace","querySelectorAll","item","targetItem","querySelector","scrollIntoView","behavior","block","clearSelection","className","parentNode","startIndex","children","placeElement","createPlaceItem","scrollTop","emptyState","filterIcon","labelSpan","textContent","countContainer","countText","toString","selectedInfo","style","display","button","addEventListener","loadMorePlaces","dots","dataset","placeData","extractPlaceData","textContainer","nameElement","address","addressElement","openingHours","hoursContainer","clockIcon","hoursText","title","selectPlaceFromList","props","opening_hours","onPlaceSelect","onLoadMore","onScrollHandler","removeEventListener","scrollHeight","clientHeight","enablePlacesLazyLoading","componentWrapper","inputClearButton","autocompleteItemsElement","placesListManager","focusedItemIndex","currentCategories","currentPromiseReject","currentPlaceDetailsPromiseReject","currentTimeout","preprocessHook","postprocessHook","sendGeocoderRequestAlt","sendPlaceDetailsRequestAlt","sendPlacesRequestAlt","categoryManager","currentPlacesPromiseReject","lastEscKeyTime","DOUBLE_ESC_THRESHOLD","debounceDelay","constructOptions","cs","getComputedStyle","parentMaxH","maxHeight","parentH","height","addClearButton","addEventListeners","resendPlacesRequestForMore","hidePlacesListAfterSelect","setValue","setType","setLang","setAddDetails","addDetails","setSkipIcons","skipIcons","setAllowNonVerifiedHouseNumber","setAllowNonVerifiedStreet","setCountryCodes","codes","countryCodes","setPosition","position","setLimit","setPlacesLimit","getValue","addFilterByCountry","addFilterByCircle","addFilterByRect","addFilterByPlace","clearFilters","addBiasByCountry","addBiasByCircle","addBiasByRect","addBiasByProximity","clearBias","setPlacesFilterByCircle","placesFilter","setPlacesFilterByRect","setPlacesFilterByPlace","setPlacesFilterByGeometry","filterByGeometry","clearPlacesFilters","setPlacesBiasByCircle","placesBias","setPlacesBiasByRect","setPlacesBiasByProximity","clearPlacesBias","on","off","once","current","currentListener","setSuggestionsFilter","suggestionsFilterFunc","setPreprocessHook","preprocessHookFunc","setPostprocessHook","postprocessHookFunc","setSendGeocoderRequestFunc","sendGeocoderRequestFunc","setSendPlaceDetailsRequestFunc","sendPlaceDetailsRequestFunc","setSendPlacesRequestFunc","sendPlacesRequestFunc","isCategoryModeEnabled","isOpen","closeDropDownList","open","openDropdownAgain","sendGeocoderRequestOrAlt","sendGeocoderRequest","sendPlaceDetailsRequest","selectCategory","categoryObj","showClearButton","clearCategoryAndNotify","appendPlaces","sendPlacesRequestOrAlt","Error","onUserInput","event","userEnteredValue","cancelPreviousRequest","cancelPreviousTimeout","removeClearButton","window","setTimeout","onDropdownDataLoad","err","canceled","log","createDropdown","populateCategoryDropdownItem","populateDropdownItem","e","stopPropagation","addEventListenerOnDropdownClick","featureIndex","categoryCount","setValueAndNotify","clearTimeout","bind","onUserKeyPress","target","itemElements","getElementsByTagName","handleArrowDownEvent","handleArrowUpEvent","handleEnterEvent","handleEscapeKey","now","Date","shouldClearCategoryOnDoubleEscape","currentTime","preventDefault","skipSelectionOnArrowKey","setActive","itemIndex","notifyValueSelected","clearFieldAndNotify","cancelCurrentPlacesRequest","removeChild","cancelPreviousPlaceDetailsRequest","noNeedToRequestPlaceDetails","sendPlaceDetailsRequestOrAlt","detailesFeature","createEvent","initEvent","dispatchEvent","addCategorySearch","wasCategoryActive","categoryKeys"],"mappings":"oPAAO,MAAMA,EAAiB,cACjBC,EAAU,OACVC,EAAY,SACZC,EAAe,YACfC,EAAW,cCKXC,EACF,iBAAOC,CAAWC,GACrB,MAAe,KAARA,GAAsB,OAARA,GAAgBC,SAASD,IAAQE,KAAKC,IAAIH,IAAQ,EAC3E,CAEO,kBAAOI,CAAYJ,GACtB,MAAe,KAARA,GAAsB,OAARA,GAAgBC,SAASD,IAAQE,KAAKC,IAAIH,IAAQ,GAC3E,CAEO,6BAAOK,CAAuBC,GACjC,MAAqD,kBAA9CA,EAAQC,WAAWC,YAAYC,aAAmCH,EAAQC,WAAWG,QAChG,CAEO,gCAAOC,CAA0BC,EAAsCC,EAAeC,GACzFD,EAASE,SAAST,IACVQ,EAAcE,aACdJ,EAAQK,6BAAsE,oBAAvCX,EAAQC,WAAWW,KAAKC,YAE/DC,KAAKC,0BAA0Bf,EAAQC,WAAY,KAAMO,EAAcE,aACvEV,EAAQC,WAAWe,iBAAmB,CAAC,gBAChCR,EAAcS,QAAUT,EAAcE,aAC7CJ,EAAQY,yBACgC,6BAAvClB,EAAQC,WAAWW,KAAKC,YAAoF,sBAAvCb,EAAQC,WAAWW,KAAKC,aAE9FC,KAAKC,0BAA0Bf,EAAQC,WAAYO,EAAcS,OAAQT,EAAcE,aACvFV,EAAQC,WAAWe,iBAAmB,CAAC,cAAe,WAC/CR,EAAcS,QACrBX,EAAQY,yBACgC,6BAAvClB,EAAQC,WAAWW,KAAKC,YAAoF,sBAAvCb,EAAQC,WAAWW,KAAKC,cAE9Fb,EAAQC,WAAWgB,OAAST,EAAcS,OAAOE,QAAQ,qBAAsBC,GAAcA,EAAEC,gBAE/FrB,EAAQC,WAAWqB,cAAgBtB,EAAQC,WAAWgB,OACtDjB,EAAQC,WAAWsB,cAAgBvB,EAAQC,WAAWuB,UAEtDxB,EAAQC,WAAWuB,UAAYxB,EAAQC,WAAWgB,OAAS,KAAOjB,EAAQC,WAAWuB,UACrFxB,EAAQC,WAAWe,iBAAmB,CAAC,UAC3C,GAER,CAEQ,gCAAOD,CAA0BU,EAAwBR,EAAgBP,GAC7E,MAAMgB,EAAqE,CACvE,gCAAiC,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MACtrB,gCAAiC,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAClsB,iCAAkC,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAC/F,iCAAkC,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,OAGnGC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"}